/*!
 * JSAV - JavaScript Algorithm Visualization Library
 * Version v1.0.1-6-gea2e525
 * Copyright (c) 2011-2015 by Ville Karavirta and Cliff Shaffer
 * Released under the MIT license.
 */
if(function($){"use strict";function initializations(jsav,options){for(var fs=JSAV.init.functions,i=0;i<fs.length;i++)$.isFunction(fs[i])&&fs[i].call(jsav,options)}function extensions(jsav,con,add){for(var prop in add)if(add.hasOwnProperty(prop)&&!(prop in con))switch(typeof add[prop]){case"function":!function(f){con[prop]=con===jsav?f:function(){return f.apply(jsav,arguments)}}(add[prop]);break;case"object":con[prop]=con[prop]||{},extensions(jsav,con[prop],add[prop]);break;default:con[prop]=add[prop]}}var JSAV=function(){create.apply(this,arguments)};JSAV.position=function(elem){var $el=$(elem),offset=$el.position(),translate=null;return translate?{left:offset.left+translate[0],top:offset.top+translate[1]}:offset};var jsavproto=JSAV.prototype;jsavproto.getSvg=function(){if(!this.svg){this.svg=Raphael(this.canvas[0]);var style=this.svg.canvas.style;style.position="absolute"}return this.svg},jsavproto.id=function(){var id=this.container[0].id;return id||(id=JSAV.utils.createUUID(),this.container[0].id=id),id},jsavproto.clear=function(){this.container.html(this._initialHTML),this.canvas=this.container.find(".jsavcanvas")},JSAV._types={},JSAV.ext={},JSAV.init=function(f){JSAV.init.functions.push(f)},JSAV.init.functions=[];var create=function(){"string"==typeof arguments[0]?this.container=$(document.getElementById(arguments[0])):arguments[0]instanceof HTMLElement?this.container=$(arguments[0]):arguments[0]&&"object"==typeof arguments[0]&&arguments[0].constructor===jQuery&&(this.container=arguments[0]);var defaultOptions=$.extend({autoresize:!0,scroll:!0},window.JSAV_OPTIONS);this.container?this.options=$.extend(defaultOptions,arguments[1]):(this.options=$.extend(defaultOptions,arguments[0]),this.container=$(this.options.element));var initialHTML=this.container.clone().wrap("<p/>").parent().html();this._initialHTML=this.container.html(),this.container.addClass("jsavcontainer"),this.canvas=this.container.find(".jsavcanvas"),0===this.canvas.size()&&(this.canvas=$("<div />").addClass("jsavcanvas").appendTo(this.container));var shutter=$("<div class='jsavshutter' />").appendTo(this.container);this._shutter=shutter,this.RECORD=!0,jQuery.fx.off=!0,initializations(this,this.options),extensions(this,this,JSAV.ext),this.logEvent({type:"jsav-init",initialHTML:initialHTML})};JSAV.init(function(){if(this.options.autoresize){var that=this;this.container.on("jsav-updaterelative",function(){var maxTop=parseInt(that.canvas.css("minHeight"),10),maxLeft=parseInt(that.canvas.css("minWidth"),10);if(that.canvas.children().each(function(index,item){var $item=$(item),itemPos=$item.position();"svg"!==item.nodeName.toLowerCase()&&(maxTop=Math.max(maxTop,itemPos.top+$item.outerHeight(!0)),maxLeft=Math.max(maxLeft,itemPos.left+$item.outerWidth(!0)))}),that.svg)for(var bbox,strokeWidth,curr=that.svg.bottom;curr;)bbox=curr.getBBox(),strokeWidth=curr.attr("stroke-width"),maxTop=Math.max(maxTop,bbox.y2+strokeWidth),maxLeft=Math.max(maxLeft,bbox.x2+strokeWidth),curr=curr.next;if(that.options.scroll){var parentWidth=that.canvas.parent().width();maxLeft=Math.min(maxLeft,parentWidth)}that.canvas.css({minHeight:maxTop,minWidth:maxLeft})})}}),window&&(window.JSAV=JSAV)}(jQuery),function(){"use strict";"undefined"!=typeof JSAV&&(JSAV._translations={en:{backwardButtonTitle:"Backward",forwardButtonTitle:"Forward",beginButtonTitle:"Begin",endButtonTitle:"End",resetButtonTitle:"Reset",undoButtonTitle:"Undo",modelButtonTitle:"Model Answer",gradeButtonTitle:"Grade",modelWindowTitle:"Model Answer",feedbackLabel:"Grading Mode: ",continuous:"Continuous",atend:"At end",fixLabel:"Continuous feedback behaviour",undo:"Undo incorrect step",fix:"Fix incorrect step",scoreLabel:"Score:",remainingLabel:"Points remaining:",lostLabel:"Points lost:",doneLabel:"DONE",yourScore:"Your score:",fixedSteps:"Fixed incorrect steps:",fixedPopup:"Your last step was incorrect. Your work has been replaced with the correct step so that you can continue.",fixFailedPopup:"Your last step was incorrect and I should fix your solution, but don't know how. So it was undone and you can try again.",undonePopup:"Your last step was incorrect. Things are reset to the beginning of the step so that you can try again.",settings:"Settings",animationSpeed:"Animation speed","(slowFast)":"(slow - fast)",valueBetween1And10:"Value between 1 (Slow) and 10 (Fast).",save:"Save",saved:"Saved...",questionClose:"Close",questionCheck:"Check Answer",questionCorrect:"Correct!",questionIncorrect:"Incorrect"},fi:{backwardButtonTitle:"Askel taaksepäin",forwardButtonTitle:"Askel eteenpäin",beginButtonTitle:"Kelaa alkuun",endButtonTitle:"Kelaa loppuun",resetButtonTitle:"Uudelleen",undoButtonTitle:"Kumoa",modelButtonTitle:"Mallivastaus",gradeButtonTitle:"Arvostele",modelWindowTitle:"Mallivastaus",feedbackLabel:"Arvostelumuoto: ",continuous:"Jatkuva",atend:"Lopussa",fixLabel:"Jatkuvan arvostelun asetukset",undo:"Kumoa väärin menneet askeleet",fix:"Korjaa väärin menneet askeleet",scoreLabel:"Pisteet:",remainingLabel:"Pisteitä jäljellä:",lostLabel:"Menetetyt pisteet:",doneLabel:"VALMIS",yourScore:"Sinun pisteesi:",fixedSteps:"Korjatut askeleet:",fixedPopup:"Viime askeleesi meni väärin. Se on korjattu puolestasi, niin että voit jatkaa tehtävää.",fixFailedPopup:"Viime askeleesi meni väärin ja minun tulisi korjata se. En kuitenkaan osaa korjata sitä, joten olen vain kumonnut sen.",undonePopup:"Viime askeleesi meni väärin. Askel on kumottu, niin että voit yrittää uudelleen.",settings:"Asetukset",animationSpeed:"Animointinopeus","(slowFast)":"(hidas - nopea)",valueBetween1And10:"Anna arvo 1:n (hidas) ja 10:n (nopea) välillä.",save:"Tallenna",saved:"Tallennettu...",questionClose:"Sulje",questionCheck:"Tarkista vastaus",questionCorrect:"Oikein!",questionIncorrect:"Väärin"},sv:{resetButtonTitle:"Börja om",undoButtonTitle:"Ångra",modelButtonTitle:"Visa lösning",gradeButtonTitle:"Poängsätt",modelWindowTitle:"Lösning",feedbackLabel:"Rättningsalternativ: ",continuous:"Rätta kontinuerligt",atend:"Poängsätt i slutet",fixLabel:"Alternativ för kontinuerlig rättning",undo:"Ångra felaktigt steg",fix:"Åtgärda felaktigt steg",scoreLabel:"Poäng:",remainingLabel:"Kvarvarande poäng:",lostLabel:"Förlorade poäng:",doneLabel:"FÄRDIG!",yourScore:"Din poäng:",fixedSteps:"Åtgärdade felaktiga steg:",fixedPopup:"Ditt senaste steg var felaktigt. Det har ersatts med det korrekta steget så att du kan fortsätta.",fixFailedPopup:"Ditt senaste steg var felaktigt men jag vet inte hur det bör åtgärdas. Därför har ditt steg ångrats och du kan försöka igen.",undonePopup:"Ditt senaste steg var felaktigt. Steget har ångrats så att du kan försöka igen.",settings:"Inställningar",animationSpeed:"Animationshastighet","(slowFast)":"(långsamt - snabbt)",valueBetween1And10:"Värde mellan 1 (långsamt) och 10 (snabbt).",save:"Spara",saved:"Sparat..."},fr:{resetButtonTitle:"Reinitialiser",undoButtonTitle:"Annuler",modelButtonTitle:"Solution",gradeButtonTitle:"Score",modelWindowTitle:"Solution",feedbackLabel:"Type de controle: ",continuous:"Continue",atend:"A la fin",fixLabel:"Parametres de controle continue",undo:"Annuler les étapes incorrectes",fix:"Corriger les étapes incorrectes",scoreLabel:"Score:",remainingLabel:"Points restants:",lostLabel:"Points perdus:",doneLabel:"Activite terminée",yourScore:"Votre score:",fixedSteps:"Corriger les étapes incorrectes:",fixedPopup:"Votre dernière action etait incorrecte. Votre action a été corrigée pour vous permettre de poursuivre.",fixFailedPopup:"Votre dernière action etait incorrecte et je ne sais pas comment la corriger. Votre action a ete annulée, essayez a nouveau.",undonePopup:"Votre dernière action etait incorrecte. La simulation a été reinitialisée. Essayez a nouveau.",settings:"Paramètres",animationSpeed:"Vitesse","(slowFast)":"(lent - rapide)",valueBetween1And10:"Vitesse entre 1 (Lent) et 10 (Rapide).",save:"Sauvegarder",saved:"Sauvegarde complète..."}},JSAV.init(function(options){var language=options.lang||"en";this._translate="object"==typeof JSAV._translations[language]?JSAV.utils.getInterpreter(JSAV._translations,language):JSAV.utils.getInterpreter(JSAV._translations,"en")}))}(jQuery),function($){"use strict";function backward(filter){if(0!==this._undo.length){for(var step=this._undo.pop(),ops=step.operations,i=ops.length-1;i>=0;i--){var prev=ops[i];prev.undo()}return this._redo.unshift(step),filter&&$.isFunction(filter)&&!filter(step)&&this.backward(filter),this.container.trigger("jsav-updatecounter",[this.currentStep()+1,this.totalSteps()+1]),step}}function forward(){if(0!==this._redo.length){for(var step=this._redo.shift(),ops=step.operations,i=0;i<ops.length;i++){var next=ops[i];next.apply()}return this._undo.push(step),this.container.trigger("jsav-updatecounter",[this.currentStep()+1,this.totalSteps()+1]),step}}function begin(){var oldFx=$.fx.off||!1;for($.fx.off=!0;this._undo.length;)this.backward();return $.fx.off=oldFx,this}function end(){var oldFx=$.fx.off||!1;for($.fx.off=!0;this._redo.length;)this.forward();return $.fx.off=oldFx,this}function anim(effect,undo){return function(){var jsav=this,args=$.makeArray(arguments),norecord=!1;if(args.length>0&&args[args.length-1]&&"object"==typeof args[args.length-1]&&args[args.length-1].record===!1&&(norecord=!0),jsav.hasOwnProperty("_redo")||(jsav=this.jsav),"none"===jsav.options.animationMode||norecord)effect.apply(this,arguments);else{var stackTop=jsav._undo[jsav._undo.length-1];stackTop||(stackTop=new AnimStep,jsav._undo.push(stackTop));var oper=new AnimatableOperation({obj:this,effect:effect,args:arguments,undo:undo});stackTop.add(oper),jsav._shouldAnimate()&&jsav.container.addClass(playingCl),oper.apply(),jsav._shouldAnimate()&&jsav._clearPlaying()}return this}}function moveWrapper(func,filter){var origStep=this.currentStep(),step=func.call(this);if(!step)return!1;if(filter&&$.isFunction(filter)){for(var filterMatch=filter(step),matched=filterMatch;!filterMatch&&this.currentStep()<this.totalSteps()&&(step=func.call(this));)filterMatch=filter(step),matched=matched||filterMatch;if(!matched)return this.jumpToStep(origStep),!1}return!0}var DEFAULT_SPEED=300,playingCl="jsavplaying";if("undefined"!=typeof JSAV){var AnimatableOperation=function(opts){this.obj=opts.obj,this.effect=opts.effect,this.args=opts.args,opts.undo&&(this.undoeffect=opts.undo),opts.undoargs&&(this.undoArgs=opts.undoargs)};AnimatableOperation.prototype.apply=function(){var self=this,obj=self.obj,state=obj.state?obj.state():null,retVal=this.effect.apply(this.obj,this.args);"undefined"==typeof retVal||retVal===this.obj?"undefined"!=typeof this.undoeffect&&$.isFunction(this.undoeffect)||(this.undoeffect=function(){return function(){obj.state(state)}}()):this.undoArgs=retVal},AnimatableOperation.prototype.undo=function(){"undefined"==typeof this.undoArgs?this.undoeffect.apply(this.obj,this.args):this.effect.apply(this.obj,this.undoArgs)};var AnimStep=function(options){this.operations=[],this.options=options||{}};if(AnimStep.prototype.add=function(oper){this.operations.push(oper)},AnimStep.prototype.isEmpty=function(){return 0===this.operations.length},JSAV.init(function(){function logAnimEvent(action){var eventData={type:action,currentStep:that.currentStep(),totalSteps:that.totalSteps()};that.logEvent(eventData)}function clearPlayingTimeout(jsav,callback){var timerid,timeouter=function(){jsav.isAnimating()||(jsav.container.removeClass(playingCl),jsav._animations=0,$.isFunction(callback)&&callback(),clearInterval(timerid))};timerid=setInterval(timeouter,50)}this._animations=0,this._redo=[],this._undo=[];var that=this,$controls=$(".jsavcontrols",this.container);this._clearPlaying=function(callback){this.isAnimating()?clearPlayingTimeout(this,callback):(this.container.removeClass(playingCl),$.isFunction(callback)&&callback())};var beginHandler=function(e){e.preventDefault(),e.stopPropagation(),that.container.hasClass(playingCl)||(that.container.addClass(playingCl),that.begin(),that._clearPlaying(),logAnimEvent("jsav-begin"))},backwardHandler=function(e,filter){e.preventDefault(),e.stopPropagation(),e.stopPropagation(),that.container.hasClass(playingCl)||(that.container.addClass(playingCl),that.backward(filter),that._clearPlaying(),logAnimEvent("jsav-backward"))},forwardHandler=function(e,filter){e.preventDefault(),e.stopPropagation(),that.container.hasClass(playingCl)||(that.container.addClass(playingCl),that.forward(filter),that._clearPlaying(),logAnimEvent("jsav-forward"))},endHandler=function(e){e.preventDefault(),e.stopPropagation(),that.container.hasClass(playingCl)||(that.container.addClass(playingCl),that.end(),that._clearPlaying(),logAnimEvent("jsav-end"))};if(0!==$controls.size()){var tmpTranslation=this._translate("beginButtonTitle");$("<span class='jsavbegin' title='"+tmpTranslation+"'>&lt;&lt;</span>").click(beginHandler).appendTo($controls),tmpTranslation=this._translate("backwardButtonTitle"),$("<span class='jsavbackward' title='"+tmpTranslation+"'>&lt;</span>").click(backwardHandler).appendTo($controls),tmpTranslation=this._translate("forwardButtonTitle"),$("<span class='jsavforward' title='"+tmpTranslation+"'>&gt;</span>").click(forwardHandler).appendTo($controls),tmpTranslation=this._translate("endButtonTitle"),$("<span class='jsavend' title='"+tmpTranslation+"'>&gt;&gt;</span>").click(endHandler).appendTo($controls),this._controlsContainer=$controls}this.container.bind({"jsav-forward":forwardHandler,"jsav-backward":backwardHandler,"jsav-begin":beginHandler,"jsav-end":endHandler});var counter=$(".jsavcounter",this.container);counter.size()>0&&(counter.text("0 / 0"),this.container.bind("jsav-updatecounter",function(evet,current,total){counter.text(current+" / "+total)})),$(document).bind("jsav-speed-change",function(e,args){that.SPEED=args})}),JSAV.anim=anim,localStorage){var spd=localStorage.getItem("jsav-speed");spd?(spd=parseInt(spd,10),isNaN(spd)&&(spd=DEFAULT_SPEED)):spd=DEFAULT_SPEED,JSAV.ext.SPEED=spd}else JSAV.ext.SPEED=DEFAULT_SPEED;JSAV.ext.begin=begin,JSAV.ext.end=end,JSAV.ext.forward=function(filter){return moveWrapper.call(this,forward,filter)},JSAV.ext.backward=function(filter){return moveWrapper.call(this,backward,filter)},JSAV.ext.currentStep=function(){return this._undo.length},JSAV.ext.totalSteps=function(){return this._undo.length+this._redo.length},JSAV.ext.animInfo=function(){var i,info={steps:this.totalSteps()},effects=0;for(i=this._undo.length;i--;)effects+=this._undo[i].operations.length;for(i=this._redo.length;i--;)effects+=this._redo[i].operations.length;return info.effects=effects,info},JSAV.ext.step=function(options){var updateRelative=options&&options.updateRelative===!1?!1:!0;return updateRelative&&this.container.trigger("jsav-updaterelative"),"none"!==this.options.animationMode&&(this._undo.push(new AnimStep(options)),options&&this.message&&options.message&&this.message(options.message)),this},JSAV.ext.clearAnimation=function(options){var opts=$.extend({undo:!0,redo:!0},options);opts.undo&&(this._undo=[]),opts.redo&&(this._redo=[])},JSAV.ext.displayInit=function(){return this.container.trigger("jsav-updaterelative"),this.clearAnimation({redo:!1}),this},JSAV.ext.jumpToStep=function(step){var stepCount=this.totalSteps(),jsav=this,stepFunction=function(){return jsav.currentStep()===step},oldFx=$.fx.off||!1;return $.fx.off=!0,step>=stepCount?this.end():0>step?this.begin():step<this.currentStep()?this.backward(stepFunction):this.forward(stepFunction),$.fx.off=oldFx,this},JSAV.ext.stepOption=function(name,value){var step=this._undo[this._undo.length-1];if(void 0!==value)step&&(step.options[name]=value);else{if("string"==typeof name)return step?step.options[name]:void 0;for(var item in name)name.hasOwnProperty(item)&&this.stepOption(item,name[item])}},JSAV.ext.recorded=function(){return this._undo.length>1&&this._undo[this._undo.length-1].isEmpty()?this._undo.pop():this.container.trigger("jsav-updaterelative"),this.begin(),this.RECORD=!1,$.fx.off=!1,this.logEvent({type:"jsav-recorded"}),this},JSAV.ext.isAnimating=function(){return!!this.container.find(":animated").size()||this._animations>0},JSAV.ext._shouldAnimate=function(){return!this.RECORD&&!$.fx.off&&this.SPEED>50},JSAV.ext.disableControls=function(){this._controlsContainer&&this._controlsContainer.addClass("jsavdisabled")},JSAV.ext.enableControls=function(){this._controlsContainer&&this._controlsContainer.removeClass("jsavdisabled")}}}(jQuery),jQuery.cssHooks.borderColor={get:function(elem){return jQuery(elem).css("border-top-color")}},jQuery.cssHooks.borderWidth={get:function(elem){return jQuery(elem).css("border-top-width")}},function($){"use strict";if("undefined"!=typeof JSAV){var inp=$("<input type='range' />");$.support.inputTypeRange="range"===inp.prop("type");var ObjCommons=function(){},objproto=ObjCommons.prototype;objproto.id=function(newId){if(newId)return this.element[0].id=newId,this;var id=this.element[0].id;return id||(id=JSAV.utils.createUUID(),this.element[0].id=id),id},objproto.bounds=function(recalculate,options){if(recalculate&&$.isFunction(this.layout))return this.layout($.extend({boundsOnly:!0},options));var pos=this.position();return $.extend({width:this.element.width(),height:this.element.height()},pos)},objproto.position=function(){return JSAV.position(this.element)},objproto.isVisible=function(){return this.element.filter(":visible").size()>0},objproto.clear=function(){this.element&&this.element.remove()},objproto._animateTranslate=JSAV.anim(function(dx,dy,options){var leftie="auto"===this.element.css("left")?dx:"+="+dx,toppie="auto"===this.element.css("top")?dy:"+="+dy;return this.element.css({left:leftie+"px",top:toppie+"px"}),this.jsav._shouldAnimate()&&(this.element.css({x:-dx,y:-dy,z:1}),this.jsav.effects.transition(this.element,{x:0,y:0,z:1},options)),[-dx,-dy,options]}),objproto.translate=function(dx,dy,options){var val=this._animateTranslate(dx,dy,options);return this._moveListeners&&this.element.trigger("jsav-object-move",[dx,dy]),val},objproto.translateX=function(dx,options){return this.translate(dx,0,options)},objproto.translateY=function(dy,options){return this.translate(0,dy,options)},objproto.moveTo=function(newLeft,newTop,options){{var curPos=this.element.position(),dx=newLeft-curPos.left,dy=newTop-curPos.top;this._animateTranslate(dx,dy,options)}this._moveListeners&&this.element.trigger("jsav-object-move",[dx,dy])},objproto._registerMoveListener=function(callback){$.isFunction(callback)&&(this._moveListeners=(this._moveListeners||0)+1,this.element.on("jsav-object-move",callback),this.container&&this.container._registerMoveListener(callback))},objproto._unregisterMoveListener=function(callback){this.element.off("jsav-object-move",callback),this._moveListeners--,this.container&&this.container._unregisterMoveListener(callback)},JSAV._types.JSAVObject=ObjCommons,JSAV.utils={};var u=JSAV.utils;u.getQueryParameter=function(name){var i,pair,params=window.location.search,vars={};if(params)for(params=params.slice(1).split("&"),i=params.length;i--;)if(pair=params[i].split("="),vars[pair[0]]=decodeURIComponent(pair[1]),name&&pair[0]===name)return pair[1];if(!name)return vars},u.createUUID=function(){for(var s=[],i=0;32>i;i++)s[i]=(~~(16*Math.random())).toString(16);return s[12]=4,s[16]=(3&s[16]|8).toString(16),"jsav-"+s.join("")},u.iterable=function(array){var i=0,array_clone=array.slice(0);return array_clone.next=function(){return this[i++]},array_clone.hasNext=function(){return i<this.length},array_clone.reset=function(){i=0},array_clone},u.isGraphicalPrimitive=function(jsavobj){return jsavobj?!!jsavobj.rObj:!1},JSAV.ext.logEvent=function(eventData){"object"==typeof eventData&&(eventData.hasOwnProperty("tstamp")||(eventData.tstamp=(new Date).toISOString()),eventData.hasOwnProperty("av")||(eventData.av=this.id()),eventData.currentStep=this.currentStep()),$.isFunction(this.options.logEvent)?this.options.logEvent(eventData):$("body").trigger("jsav-log-event",[eventData])};var dialogBase='<div class="jsavdialog"></div>',$modalElem=null;u.dialog=function(html,options){options=$.extend({},{modal:!0,closeOnClick:!0},options);var i,l,attr,modal=options.modal,$dialog=$(options.dialogBase||dialogBase),attrOptions=["width","height","minWidth","minHeight","maxWidth","maxHeight"];"string"==typeof html?$dialog.html(html):$.isFunction(html)?$dialog.html(html()):$dialog.append(html),"title"in options&&$dialog.prepend("<h2>"+options.title+"<a href='#' class='jsavdialogclose'>&times;</a></h2>"),"dialogClass"in options&&$dialog.addClass(options.dialogClass);for(i=0,l=attrOptions.length;l>i;i++)attr=attrOptions[i],void 0!==options[attr]&&$dialog.css(attr,options[attr]);var $doc=$(document),$win=$(window),winHeight=($doc.height(),$doc.width(),$win.height()),winWidth=$win.width(),scrollLeft=$doc.scrollLeft(),scrollTop=$doc.scrollTop();"width"in options||$dialog.css("width",Math.max(500,.7*winWidth));var close=function(e){e&&e.preventDefault(),$modalElem&&$modalElem.detach(),$dialog.remove(),$.isFunction(options.closeCallback)&&options.closeCallback()};if(modal&&($modalElem=$modalElem||$('<div class="jsavmodal" />'),$modalElem.appendTo($("body")),options.closeOnClick&&$modalElem.click(close)),$dialog.find(".jsavdialogclose").click(close),"closeText"in options){var closeButton=$('<button type="button" class="jsavrow">'+options.closeText+"</button>").click(close);$dialog.append(closeButton)}var $dial=$dialog.appendTo(options.dialogRootElement||$("body"));$dial.draggable();var center=function(){$dialog.css({top:Math.max(scrollTop+(winHeight-$dialog.outerHeight())/2,0),left:scrollLeft+(winWidth-$dialog.outerWidth())/2})};return center(),$dial.show=function(){center(),$dial.fadeIn()},$dial.close=close,$dial},u.value2type=function(val,valtype){return"number"===valtype?Number(val):"boolean"===valtype?"boolean"==typeof val?val:"string"==typeof val?"true"===val:!!val:val};var dummyTestFunction=function(){return!0};u.rand={random:Math.random,numKey:function(min,max){return Math.floor(this.random()*(max-min)+min)},numKeys:function(min,max,num,options){var keys,opts=$.extend(!0,{sorted:!1,test:dummyTestFunction,tries:10},options),tries=opts.tries,size=num;do for(keys=[],size=num;size--;)keys.push(this.numKey(min,max));while(tries--&&!opts.test(keys));return opts.sorted&&keys.sort(opts.sortfunc||function(a,b){return a-b}),keys},sample:function(collection,num,options){var dupl,tmp,rnd,opts=$.extend(!0,{test:dummyTestFunction,tries:10},options),max=collection.length,tries=opts.tries;if(num>max||0>num)return void 0;do{dupl=collection.slice(0);for(var i=0;num>i;i++)tmp=dupl[i],rnd=this.numKey(i,max),dupl[i]=dupl[rnd],dupl[rnd]=tmp}while(tries--&&!opts.test(dupl));return dupl.slice(0,num)}},u.extend=function(constructor,superConstructor){function surrogateConstructor(){}surrogateConstructor.prototype=superConstructor.prototype;var prototypeObject=new surrogateConstructor;prototypeObject.constructor=constructor,constructor.prototype=prototypeObject},u.getInterpreter=function(langJSON,selectedLanguage){var trans;return"string"==typeof langJSON?(-1!==langJSON.indexOf("{lang}")&&(langJSON=langJSON.replace("{lang}",selectedLanguage),selectedLanguage=void 0),$.ajax({url:langJSON,async:!1,dataType:"json",success:function(data){trans=selectedLanguage?data[selectedLanguage]:data}})):"object"==typeof langJSON&&(trans=selectedLanguage?langJSON[selectedLanguage]:langJSON),"object"!=typeof trans?(console.warn("Language not found ("+selectedLanguage+")"),function(label){return"["+label+"]"}):function(label){return"undefined"==typeof trans[label]?(console.warn("Cannot find label: "+label),"["+label+"]"):trans[label]}},u.replaceLabels=function(string,replacementObject){if(!replacementObject||"object"!=typeof replacementObject)return string;var result=string;for(var label in replacementObject)if(replacementObject.hasOwnProperty(label)){var reg=new RegExp("{"+label+"}","g");result=result.replace(reg,replacementObject[label])}return result},u.getUndoableFunction=function(jsav,func,undoFunc){var f=JSAV.anim(func,undoFunc);return function(){f.apply(jsav,arguments)}},/*!
// based on seedrandom.js version 2.0.
// Author: David Bau 4/2/2011
// http://davidbau.com/encode/seedrandom.js
//
// 12/12/2011: Original code modified to add the methods to JSAV.utils.rand
// instead of overwriting the Math.random().
//
// LICENSE (BSD):
//
// Copyright 2010 David Bau, all rights reserved.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
//   1. Redistributions of source code must retain the above copyright
//      notice, this list of conditions and the following disclaimer.
//
//   2. Redistributions in binary form must reproduce the above copyright
//      notice, this list of conditions and the following disclaimer in the
//      documentation and/or other materials provided with the distribution.
//
//   3. Neither the name of this module nor the names of its contributors may
//      be used to endorse or promote products derived from this software
//      without specific prior written permission.
//
// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
// "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
function(pool,math,width,chunks,significance,overflow,startdenom){function ARC4(key){var t,u,me=this,keylen=key.length,i=0,j=me.i=me.j=me.m=0;for(me.S=[],me.c=[],keylen||(key=[keylen++]);width>i;)me.S[i]=i++;for(i=0;width>i;i++)t=me.S[i],j=lowbits(j+t+key[i%keylen]),u=me.S[j],me.S[i]=u,me.S[j]=t;me.g=function(count){var s=me.S,i=lowbits(me.i+1),t=s[i],j=lowbits(me.j+t),u=s[j];s[i]=u,s[j]=t;for(var r=s[lowbits(t+u)];--count;)i=lowbits(i+1),t=s[i],j=lowbits(j+t),u=s[j],s[i]=u,s[j]=t,r=r*width+s[lowbits(t+u)];return me.i=i,me.j=j,r},me.g(width)}function flatten(obj,depth,result,prop,typ){if(result=[],typ=typeof obj,depth&&"object"==typ)for(prop in obj)if(prop.indexOf("S")<5)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:obj+("string"!=typ?"\x00":"")}function mixkey(seed,key,smear,j){for(seed+="",smear=0,j=0;j<seed.length;j++)key[lowbits(j)]=lowbits((smear^=19*key[lowbits(j)])+seed.charCodeAt(j));seed="";for(j in key)seed+=String.fromCharCode(key[j]);return seed}function lowbits(n){return n&width-1}math.seedrandom=function(seed,use_entropy){var arc4,key=[];return seed=mixkey(flatten(use_entropy?[seed,pool]:arguments.length?seed:[(new Date).getTime(),pool,window],3),key),arc4=new ARC4(key),mixkey(arc4.S,pool),math.random=function(){for(var n=arc4.g(chunks),d=startdenom,x=0;significance>n;)n=(n+x)*width,d*=width,x=arc4.g(1);for(;n>=overflow;)n/=2,d/=2,x>>>=1;return(n+x)/d},seed},startdenom=Math.pow(width,chunks),significance=Math.pow(2,significance),overflow=2*significance,mixkey(math.random(),pool)}([],u.rand,256,6,52);/*!
 End seedrandom.js
 */
var _helpers={};u._helpers=_helpers;var JSAV_CLASS_NAMES=["jsavarray","jsavhorizontalarray","jsavverticalarray","jsavbararray","jsavindexed","jsavnode","jsavindex","jsavcommontree","jsavtree","jsavbinarytree","jsavbinarynode","jsavtreenode","jsavlistnode","jsavlist","jsavverticallist","jsavhorizontallist","jsavmatrix","jsavgraphnode","jsavvariable","jsavedge"];_helpers.setElementClasses=function(element,cls){var clsList,curCls,c,i,elem=element[0];if(elem instanceof SVGElement&&"object"==typeof elem.classList){for(clsList=elem.classList,curCls=Array.prototype.slice.call(elem.classList,0),i=curCls.length;i--;)c=curCls[i],-1===JSAV_CLASS_NAMES.indexOf(c)&&-1===cls.indexOf(c)&&clsList.remove(c);for(i=cls.length;i--;)c=cls[i],clsList.contains(c)||clsList.add(c)}else{for(clsList=element.first().attr("class").split(" "),curCls=clsList.slice(0),i=curCls.length;i--;)c=curCls[i],-1===JSAV_CLASS_NAMES.indexOf(c)&&-1===cls.indexOf(c)&&clsList.splice(clsList.indexOf(c),1);for(i=cls.length;i--;)c=cls[i],-1===clsList.indexOf(c)&&clsList.push(c);element.first().attr("class",clsList.join(" "))}},_helpers.elementClasses=function(element){var cls,i,elem=element[0],customCls=[];for(cls=elem instanceof SVGElement&&"object"==typeof elem.classList?Array.prototype.slice.call(element[0].classList,0):element.first().attr("class").split(" "),i=cls.length;i--;)-1===JSAV_CLASS_NAMES.indexOf(cls[i])&&customCls.push(cls[i]);return customCls},_helpers.css=function(cssprop,value,options){return"string"==typeof cssprop&&"undefined"==typeof value?this.element.css(cssprop):this._setcss(cssprop,value,options)},_helpers._setcss=function(cssprop,value,options){var oldProps,newprops,el=this.element,opts=options;if("string"==typeof cssprop&&"undefined"!=typeof value)oldProps={},oldProps[cssprop]=el.css(cssprop),newprops={},newprops[cssprop]=value,value=void 0;else{oldProps=$.extend(!0,{},cssprop);for(var i in cssprop)cssprop.hasOwnProperty(i)&&(oldProps[i]=el.css(i));opts=value,newprops=cssprop}return this.jsav._shouldAnimate()?this.jsav.effects.transition(this.element,newprops,opts):this.element.css(newprops),[oldProps,value,options]},_helpers.getIndices=function($elems,indices){if("undefined"==typeof indices)return $elems;if($.isFunction(indices))return $elems.filter(indices);if($.isArray(indices))return $elems.filter(function(index){for(var i=0;i<indices.length;i++)if(indices[i]===index)return!0;return!1});if("number"==typeof indices)return $elems.eq(indices);if("boolean"==typeof indices)return indices?$elems:$({});try{return $elems.eq(parseInt(indices,10))}catch(err){return $({})}},_helpers.normalizeIndices=function($elems,indices,test){var i,l,normIndices=[],$normElems=this.getIndices($elems,indices);for("undefined"!=typeof test&&($normElems=$normElems.filter(test)),i=0,l=$normElems.size();l>i;i++)normIndices.push($elems.index($normElems.get(i)));return normIndices},_helpers.cssEquals=function(jsavObj1,jsavObj2,cssProps){var cssprop,i;if($.isArray(cssProps)){for(i=0;i<cssProps.length;i++)if(cssprop=cssProps[i],jsavObj1.css(cssprop)!==jsavObj2.css(cssprop))return!1}else if(cssprop=cssProps,jsavObj1.css(cssprop)!==jsavObj2.css(cssprop))return!1;return!0},_helpers.classEquals=function(jsavObj1,jsavObj2,classNames){var clazzname,i,l;if($.isArray(classNames)){for(i=0,l=classNames.length;l>i;i++)if(clazzname=classNames[i],jsavObj1.hasClass(clazzname)!==jsavObj2.hasClass(clazzname))return!1}else if(clazzname=classNames,jsavObj1.hasClass(clazzname)!==jsavObj2.hasClass(clazzname))return!1;return!0};var animateToNewRelativePosition=function(jsavobj,relElem,offsetLeft,offsetTop,anchor,myAnchor){var el=jsavobj.element,elemCurPos=el.position();el.position({my:myAnchor,at:anchor,of:relElem,offset:offsetLeft+" "+offsetTop,collision:"none"});var elemPos=el.position(),elemLeft=elemPos.left,elemTop=elemPos.top;return elemLeft===elemCurPos.left&&elemTop===elemCurPos.top?{left:0,top:0}:(el.css({left:elemCurPos.left,top:elemCurPos.top}),jsavobj.moveTo(elemLeft,elemTop),{left:elemLeft-elemCurPos.left,top:elemTop-elemCurPos.top})};_helpers._setRelativeFollowUpdater=function(jsavobj,target,options){jsavobj._relativehandle&&(jsavobj._relativetarget._unregisterMoveListener(jsavobj._relativehandle),jsavobj.jsav.container.off("jsav-updaterelative",jsavobj._updaterelativehandle));var leftSum=0,topSum=0,callbackFunc=options&&$.isFunction(options.callback),updaterelativehandle=function(){(0!==leftSum||0!==topSum)&&(jsavobj.translate(leftSum,topSum),leftSum=0,topSum=0)},relativehandle=function(evt,dleft,dtop){evt.stopPropagation(),callbackFunc&&options.callback(dleft,dtop),leftSum+=dleft,topSum+=dtop};(!options||options.autotranslate)&&jsavobj.jsav.container.on("jsav-updaterelative",updaterelativehandle),jsavobj._relativetarget=target,jsavobj._relativehandle=relativehandle,jsavobj._updaterelativehandle=updaterelativehandle,target._registerMoveListener(relativehandle)},_helpers.setRelativePositioning=function(jsavobj,options){var el=jsavobj.element,relElem=options.relativeTo,anchor=options.anchor||"center",myAnchor=options.myAnchor||"center",follow=!!options.follow;relElem instanceof jQuery||(relElem=relElem.nodeType===Node.ELEMENT_NODE?$(relElem):relElem.constructor===JSAV._types.ds.AVArray&&"relativeIndex"in options?relElem.index(options.relativeIndex).element:JSAV.utils.isGraphicalPrimitive(relElem)?$(relElem.rObj.node):relElem.element||relElem),el.css({position:"absolute"});var offsetLeft=parseInt(options.left||0,10),offsetTop=parseInt(options.top||0,10);if(jsavobj._relativehandle){var move=animateToNewRelativePosition(jsavobj,relElem,offsetLeft,offsetTop,anchor,myAnchor);$.isFunction(options.callback)&&options.callback(move.left,move.top)}else el.position({my:myAnchor,at:anchor,of:relElem,offset:offsetLeft+" "+offsetTop,collision:"none"});follow&&this._setRelativeFollowUpdater(jsavobj,options.relativeTo,$.extend({autotranslate:!0},options))},_helpers.handlePosition=function(jsavobj){var el=jsavobj.element,options=jsavobj.options;if("relativeTo"in options||"left"in options||"top"in options||"bottom"in options||"right"in options){var pos,positions=["right","bottom","top","left"],posProps={position:"absolute"};if(options.center=!1,"relativeTo"in options&&options.relativeTo)this.setRelativePositioning(jsavobj,options);else for(var i=positions.length;i--;)pos=positions[i],options.hasOwnProperty(pos)&&(posProps[positions[i]]=options[pos]),el.css(posProps)}},_helpers.handleVisibility=function(jsavobj,options){jsavobj.element.css("display","none");var visible="boolean"==typeof options.visible&&options.visible===!0;visible&&jsavobj.show(options)},_helpers._toggleClass=function(className,options){var opts=$.extend({animate:!0},options);return this.jsav._shouldAnimate()&&opts.animate?this.jsav.effects._toggleClass(this.element,className,options):this.element.toggleClass(className),[className,options]},_helpers.addClass=function(className,options){return this.element.hasClass(className)?this:this.toggleClass(className,options)},_helpers.removeClass=function(className,options){return this.element.hasClass(className)?this.toggleClass(className,options):this},_helpers.hasClass=function(className){return this.element.hasClass(className)}}}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var MessageHandler=function(jsav,output){this.jsav=jsav,this.output=output,this.output&&"title"in jsav.options&&this.output.html("<div class='jsavtitle'>"+jsav.options.title+"</div>")};MessageHandler.prototype.umsg=JSAV.anim(function(msg,options){options&&options.fill&&"object"==typeof options.fill&&(msg=JSAV.utils.replaceLabels(msg,options.fill));var opts=$.extend({color:"black",preserve:!1},options);if(this.output)if(this.output.hasClass("jsavline")&&opts.preserve){var el=this.output.find("div:last"),newmsg="<span style='color:"+opts.color+";'>"+msg+"</span>";el.size()>0?el.append(newmsg):this.output.html("<div style='color:"+opts.color+";'>"+msg+"</div>")}else this.output.hasClass("jsavline")?this.output.html("<div style='color:"+opts.color+";'>"+msg+"</div>"):(this.output.append("<div style='color:"+opts.color+";'>"+msg+"</div>"),this.output[0]&&(this.output[0].scrollTop=this.output[0].scrollHeight));return this.jsav.RECORD||this.jsav.container.trigger("jsav-message",[msg,options]),this}),MessageHandler.prototype.clear=JSAV.anim(function(){this.output&&this.output.html("")}),MessageHandler.prototype.state=function(newValue){return newValue?(this.output.html(newValue),void this.jsav.container.trigger("jsav-message",[newValue,this.options])):this.output.html()||"<span/>"},JSAV.ext.umsg=function(msg,options){this._msg.umsg(msg,options)},JSAV.ext.clearumsg=function(){this._msg.clear()},JSAV.init(function(options){var output=options.output?$(options.output):$(this.container).find(".jsavoutput");this._msg=new MessageHandler(this,output)})}}(jQuery),function($){"use strict";function callOrQueue(self,queue,fn){queue===!0?self.queue(fn):queue?self.queue(queue,fn):fn()}$.fn.extend({jsavToggleClass:function(classNames,opts){var self=this,opt=$.extend({queue:!0,easing:"linear",delay:0},opts);opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,$.cssEase[opt.easing]&&(opt.easing=$.cssEase[opt.easing]);var transitionValue="all "+opt.duration+"ms "+opt.easing;if(opt.delay&&(transitionValue+=" "+opt.delay+"ms"),0===opt.duration)return this.toggleClass(this,arguments);var RUN_DONE=!1,run=function(nextCall){var bound=!1,called=!1,cb=function(){called||(called=!0,bound&&self.unbind($.support.transitionEnd,cb),self.each(function(){this.style[$.support.transition]=null}),"function"==typeof opt.complete&&opt.complete.apply(self),"function"==typeof nextCall&&nextCall())};opt.duration>0&&$.support.transitionEnd&&$.transit.useTransitionEnd&&(bound=!0,self.bind($.support.transitionEnd,cb)),window.setTimeout(cb,opt.duration),RUN_DONE||self.each(function(){opt.duration>0&&(this.style[$.support.transition]=transitionValue),$(this).toggleClass(classNames)}),RUN_DONE=!0},deferredRun=function(next){this.offsetWidth,run(next)};return callOrQueue(self,opt.queue,deferredRun),this}});var parseValueEffectParameters=function(){var params={args1:[],args2:[],from:arguments[0]},secondstrPos=1;return"number"==typeof arguments[1]&&(params.args1=[arguments[1]],secondstrPos=2),params.to=arguments[secondstrPos],"number"==typeof arguments[secondstrPos+1]&&(params.args2=[arguments[secondstrPos+1]]),params},doValueEffect=function(opts){var $fromValElem,$toValElem,toPos,from=opts.from,to=opts.to,val=from.value.apply(from,opts.args1),oldValue=to.value.apply(to,opts.args2);if("swap"===opts.mode?from.value.apply(from,opts.args1.concat([oldValue,{record:!1}])):("move"===opts.mode||"undefined"!=typeof opts.old)&&from.value.apply(from,opts.args1.concat(["undefined"!=typeof opts.old?opts.old:"",{record:!1}])),to.value.apply(to,opts.args2.concat([val,{record:!1}])),$fromValElem=from.constructor===JSAV._types.ds.AVArray?from.element.find("li:eq("+opts.args1[0]+") .jsavvaluelabel"):from.element.hasClass("jsavlabel")?from.element:from.element.find(".jsavvaluelabel"),$toValElem=to.constructor===JSAV._types.ds.AVArray?to.element.find("li:eq("+opts.args2[0]+") .jsavvaluelabel"):to.element.hasClass("jsavlabel")?to.element:to.element.find(".jsavvaluelabel"),this._shouldAnimate()){var toValElemHeight=$toValElem.height(),fromValElemHeight=$fromValElem.height();if($toValElem.position({of:$fromValElem}),"swap"===opts.mode)if(toPos=$.extend({},$toValElem.position()),$toValElem.css("bar"!==to.options.layout?{left:0,top:0}:{left:0,bottom:0,top:""}),$fromValElem.position({of:$toValElem}),$toValElem.css(toPos),"bar"!==from.options.layout)$fromValElem.transition({left:0,top:0},this.SPEED,"linear");else{var bottom=$fromValElem.parent().height()-$fromValElem.position().top-fromValElemHeight;$fromValElem.css({top:"",bottom:bottom}),$fromValElem.transition({left:0,bottom:0},this.SPEED,"linear")}if("bar"!==to.options.layout)$toValElem.transition({left:0,top:0},this.SPEED,"linear");else{var bottom=$toValElem.parent().height()-$toValElem.position().top-toValElemHeight;$toValElem.css({top:"",bottom:bottom}),$toValElem.transition({left:0,bottom:0},this.SPEED,"linear")}}return[{from:to,args1:opts.args2,to:from,args2:opts.args1,old:oldValue,mode:opts.mode}]};JSAV.ext.effects={_toggleClass:function($elems,clazz,options){this._animations+=$elems.length;var that=this;$elems.jsavToggleClass(clazz,{duration:options&&options.duration||this.SPEED,delay:options&&options.delay||0,complete:function(){that._animations--}})},transition:function($elems,cssProps,options){this._animations+=$elems.length;var that=this;$elems.transition(cssProps,{duration:options&&options.duration||this.SPEED,delay:options&&options.delay||0,complete:function(){that._animations--}})},_toggleVisible:function(){return this.jsav._shouldAnimate()?this.element.fadeToggle(this.jsav.SPEED):this.element.toggle(),[]},show:function(options){return 0===this.element.filter(":visible").size()&&this._toggleVisible(options),this},hide:function(options){return this.element.filter(":visible").size()>0&&this._toggleVisible(options),this},copyValue:function(){var params=parseValueEffectParameters.apply(null,arguments);JSAV.anim(doValueEffect).call(this,params)},moveValue:function(){var params=parseValueEffectParameters.apply(null,arguments);params.mode="move",JSAV.anim(doValueEffect).call(this,params)},swapValues:function(){var params=parseValueEffectParameters.apply(null,arguments);params.mode="swap",JSAV.anim(doValueEffect).call(this,params)},swap:function($str1,$str2,options){var opts=$.extend({translateY:!0,arrow:!0,highlight:!0,swapClasses:!1},options),$val1=$str1.find("span.jsavvalue"),$val2=$str2.find("span.jsavvalue"),classes1=$str1.attr("class"),classes2=$str2.attr("class"),posdiffX=JSAV.position($str1).left-JSAV.position($str2).left,posdiffY=opts.translateY?JSAV.position($str1).top-JSAV.position($str2).top:0,$both=$($str1).add($str2),speed=this.SPEED/5,val1=$val1[0],val2=$val2[0],aparent=val1.parentNode,asibling=val1.nextSibling===val2?val1:val1.nextSibling;if(val2.parentNode.insertBefore(val1,val2),aparent.insertBefore(val2,asibling),opts.swapClasses&&($str1.attr("class",classes2),$str2.attr("class",classes1)),this._shouldAnimate()){if("Raphael"in window&&opts.arrow){var off1=$val1.offset(),off2=$val2.offset(),coff=this.canvas.offset(),x1=off1.left-coff.left+$val1.outerWidth()/2,x2=off2.left-coff.left+$val2.outerWidth()/2,y1=off1.top-coff.top+$val1.outerHeight()+5,y2=y1,curve=20,cx1=x1,cx2=x2,cy1=y2+curve,cy2=y2+curve,arrowStyle="classic-wide-long";if(posdiffY>1||1>posdiffY){y2=off2.top-coff.top+$val2.outerHeight()+5;var angle=(y2-y1)/(x2-x1),c1=Math.pow(y1,2)-curve*curve/(1+angle*angle),c2=Math.pow(y2,2)-curve*curve/(1+angle*angle);cy1=y1+Math.sqrt(y1*y1-c1),cx1=x1-angle*Math.sqrt(y1*y1-c1),cy2=y2+Math.sqrt(y2*y2-c2),cx2=x2-angle*Math.sqrt(y2*y2-c2)}var arr=this.getSvg().path("M"+x1+","+y1+"C"+cx1+","+cy1+" "+cx2+","+cy2+" "+x2+","+y2).attr({"arrow-start":arrowStyle,"arrow-end":arrowStyle,"stroke-width":5,stroke:"lightGray"})}$val2.css({x:-posdiffX,y:-posdiffY,z:1}),$val1.css({x:posdiffX,y:posdiffY,z:1}),this._animations+=1;var jsav=this;opts.highlight&&$both.addClass("jsavswap",3*speed),$val1.transition({x:0,y:0,z:0},7*speed,"linear"),$val2.transition({x:0,y:0,z:0},7*speed,"linear",function(){arr&&arr.remove(),opts.highlight&&$both.removeClass("jsavswap",3*speed),jsav._animations-=1})}}}}(jQuery),function($){"use strict";var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"],eventhandler=function(eventType,eventOpts){return function(data,handler,options){var defaultopts={edge:!1},jsav=this.jsav,opts=defaultopts;return"object"==typeof options?opts=$.extend(defaultopts,options):"object"==typeof handler&&(opts=$.extend(defaultopts,handler)),(!opts.edge||opts.node)&&this.element.on(eventType,eventOpts.selector,function(e){for(var $curr=$(this),elem=$curr.data(eventOpts.dataField);!elem;)$curr=$curr.parent(),elem=$curr.data(eventOpts.dataField);if(jsav.logEvent({type:eventOpts.logEventPrefix+eventType,objid:elem.id(),objvalue:elem.value()}),$.isFunction(data))data.call(elem,e);else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e),handler.apply(elem,params)}}),opts.edge&&this.jsav.canvas.on(eventType,'.jsavedge[data-container="'+this.id()+'"]',function(e){var edge=$(this).data("edge");if(jsav.logEvent({type:"jsav-edge-"+eventType,startvalue:edge.start().value(),endvalue:edge.end().value(),startid:edge.start().id(),endid:edge.end().id()}),$.isFunction(data))data.call(edge,e);else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e),handler.apply(edge,params)}}),this}},on=function(eventOpts){return function(eventName,data,handler,options){return eventhandler(eventName,eventOpts).call(this,data,handler,options),this}};JSAV.utils._events={_addEventSupport:function(proto,options){for(var opts=$.extend({selector:".jsavnode",logEventPrefix:"jsav-node-",dataField:"node"},options),i=events.length;i--;)proto[events[i]]=eventhandler(events[i],opts);proto.on=on(opts)}}}(jQuery),"undefined"!=typeof Raphael)!function($){"use strict";if("undefined"!=typeof JSAV){var JSAVGraphical=function(){};JSAVGraphical.prototype={show:function(options){1!==this.css("opacity")&&this.css({opacity:1},options)},hide:function(options){0!==this.css("opacity")&&this.css({opacity:0},options)},isVisible:function(){return 0!==this.css("opacity")},transform:function(transform,options){var oldTrans=this.rObj.transform();return this.jsav._shouldAnimate()?this.rObj.animate({transform:transform},this.jsav.SPEED):this.rObj.transform(transform,options),oldTrans},rotate:JSAV.anim(function(deg){return this.transform("...r"+deg),[0-deg]}),scale:JSAV.anim(function(sx,sy){return this.transform("...S"+sx+","+sy),[1/sx,1/sy]}),scaleX:function(sx,options){return this.scale(sx,1,options)},scaleY:function(sy,options){return this.scale(1,sy,options)},translate:JSAV.anim(function(dx,dy){return this.transform("...T"+dx+","+dy),[0-dx,0-dy]}),translateX:function(dx,options){return this.translate(dx,0,options)},translateY:function(dy,options){return this.translate(0,dy,options)},_setattrs:JSAV.anim(function(props,options){var oldProps=$.extend(!0,{},props);for(var i in props)props.hasOwnProperty(i)&&(oldProps[i]=this.rObj.attr(i));if(!this.jsav._shouldAnimate()||options&&options.dontAnimate)for(i in props)props.hasOwnProperty(i)&&this.rObj.attr(i,props[i]);else this.rObj.animate(props,this.jsav.SPEED);return[oldProps]}),css:function(props,options){return"string"==typeof props?this.rObj.attr(props):this._setattrs(props,options)},state:function(newState){if("undefined"!=typeof newState){for(var i in newState)newState.hasOwnProperty(i)&&this.rObj.attr(i,newState[i]);return this}var attrs=$.extend(!0,{},this.rObj.attrs);return attrs},bounds:function(){var bbox=this.rObj.getBBox();return{left:bbox.x,top:bbox.y,width:bbox.width,height:bbox.height}},id:JSAV._types.JSAVObject.prototype.id,clear:function(){this.rObj.remove()}};var graphicalproto=JSAVGraphical.prototype;graphicalproto.addClass=JSAV.utils._helpers.addClass,graphicalproto.removeClass=JSAV.utils._helpers.removeClass,graphicalproto.hasClass=JSAV.utils._helpers.hasClass,graphicalproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass);for(var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"],eventhandler=function(eventType){return function(data,handler){var self=this;return this.element.on(eventType,function(e){if(self.jsav.logEvent({type:"jsav-graphical-"+eventType,objid:self.id()}),$.isFunction(data))data.call(self,e);else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e),handler.apply(self,params)}}),this}},i=events.length;i--;)graphicalproto[events[i]]=eventhandler(events[i]);graphicalproto.on=function(eventName,data,handler){return eventhandler(eventName).call(this,data,handler),this};var init=function(obj,jsav,props){obj.jsav=jsav,obj.element=$(obj.rObj.node).data("svgelem",obj.rObj);var prop=$.extend({visible:!0},props);for(var i in prop)prop.hasOwnProperty(i)&&obj.rObj.attr(i,prop[i]);if(!("opacity"in prop)){obj.rObj.attr("opacity",0);var visible="boolean"==typeof prop.visible&&prop.visible===!0;visible&&obj.show(prop)}},translatePoint=function(point,dx,dy,options){var pathElem,currPath=this.rObj.attrs.path,newPath="";if(point>currPath.length)return this;for(var i=0,l=currPath.length;l>i;i++)pathElem=currPath[i],newPath+=i===point?pathElem[0]+" "+(+pathElem[1]+dx)+" "+(+pathElem[2]+dy):pathElem.join(" ");return this._setattrs({path:newPath},options),this},movePoints=function(points,options){var pathElem,i,l,currPath=this.rObj.attrs.path,newPath=currPath.slice(),newPoints=this.points();for(i=0,l=points.length;l>i;i++){var p=points[i];pathElem=currPath[p[0]],newPath[p[0]]=[pathElem[0],p[1],p[2]],newPoints[p[0]]=p.slice(1)}var np="";for(i=0,l=newPath.length;l>i;i++)pathElem=newPath[i],np+=pathElem.join(" ");return this._setpoints(newPoints),this._setattrs({path:np},$.extend({dontAnimate:""+currPath=="M-1,-1L-1,-1"},options)),this},_setpoints=JSAV.anim(function(newPoints){var oldPoints=$.extend(!0,[],this._points);return this._points=newPoints,[oldPoints]}),points=function(){return $.extend(!0,[],this._points)},Circle=function(jsav,raphael,x,y,r,props){return this.rObj=raphael.circle(x,y,r),init(this,jsav,props),this};JSAV.utils.extend(Circle,JSAVGraphical);var cproto=Circle.prototype;cproto.center=function(x,y,options){return"undefined"==typeof x?this.rObj.attr(["cx","cy"]):($.isArray(x)&&2===x.length?this._setattrs({cx:x[0],cy:x[1]},options):"undefined"!=typeof y?this._setattrs({cx:x,cy:y},options):"cx"in x&&"cy"in x&&this._setattrs(x,options),this)},cproto.radius=function(r,options){return"undefined"==typeof r?this.rObj.attr("r"):(this._setattrs({r:r},options),this)};var Rect=function(jsav,raphael,x,y,w,h,r,props){return this.rObj=raphael.rect(x,y,w,h,r),init(this,jsav,props),this};JSAV.utils.extend(Rect,JSAVGraphical);var rectproto=Rect.prototype;rectproto.width=function(w,options){return"undefined"==typeof w?this.rObj.attr("width"):(this._setattrs({width:w},options),this)},rectproto.height=function(h,options){return"undefined"==typeof h?this.rObj.attr("height"):(this._setattrs({height:h},options),this)};var Line=function(jsav,raphael,x1,y1,x2,y2,props){return this.rObj=raphael.path("M"+x1+" "+y1+"L"+x2+" "+y2),init(this,jsav,props),this._points=[[x1,y1],[x2,y2]],this};JSAV.utils.extend(Line,JSAVGraphical),Line.prototype.translatePoint=translatePoint,Line.prototype._polylineMovePoints=movePoints,Line.prototype.movePoints=function(newx1,newy1,newx2,newy2){return this._polylineMovePoints($.isArray(newx1)?newx1:[[0,newx1,newy1],[1,newx2,newy2]])},Line.prototype.points=points,Line.prototype._setpoints=_setpoints;var Ellipse=function(jsav,raphael,x,y,rx,ry,props){return this.rObj=raphael.ellipse(x,y,rx,ry),init(this,jsav,props),this};JSAV.utils.extend(Ellipse,JSAVGraphical);var ellproto=Ellipse.prototype;ellproto.center=cproto.center,ellproto.radius=function(x,y,options){return"undefined"==typeof x?this.rObj.attr(["rx","ry"]):($.isArray(x)&&2===x.length?this._setattrs({rx:x[0],ry:x[1]},options):"undefined"!=typeof y?this._setattrs({rx:x,ry:y},options):"rx"in x&&"ry"in x&&this._setattrs(x,options),this)};var Polyline=function(jsav,raphael,points,close,props){for(var path="M ",i=0,l=points.length;l>i;i++)i&&(path+="L"),path+=points[i][0]+" "+points[i][1];return close&&(path+="Z"),this.rObj=raphael.path(path),init(this,jsav,props),this._points=points,this};JSAV.utils.extend(Polyline,JSAVGraphical),Polyline.prototype.translatePoint=translatePoint,Polyline.prototype.movePoints=movePoints,Polyline.prototype.points=points,Polyline.prototype._setpoints=_setpoints;var Path=function(jsav,raphael,path,props){return this.rObj=raphael.path(path),init(this,jsav,props),this};JSAV.utils.extend(Path,JSAVGraphical),Path.prototype.path=function(newPath,options){return"undefined"==typeof newPath?this.rObj.attr("path"):this._setattrs({path:newPath},options)};var Set=function(jsav,raphael,props){return this.rObj=raphael.set(),init(this,jsav,props),this};JSAV.utils.extend(Set,JSAVGraphical);var setproto=Set.prototype;setproto.push=function(g){return this.rObj.push(g.rObj),this};var getSvgCanvas=function(jsav,props){return"undefined"!=typeof props&&props.container?props.container.getSvg():jsav.getSvg()};JSAV.ext.g={circle:function(x,y,r,props){var svgCanvas=getSvgCanvas(this,props);return new Circle(this,svgCanvas,x,y,r,props)},rect:function(x,y,w,h,r,props){"object"==typeof r&&(props=r,r=0);var svgCanvas=getSvgCanvas(this,props);return new Rect(this,svgCanvas,x,y,w,h,r,props)},line:function(x1,y1,x2,y2,props){var svgCanvas=getSvgCanvas(this,props);return new Line(this,svgCanvas,x1,y1,x2,y2,props)},ellipse:function(x,y,rx,ry,props){var svgCanvas=getSvgCanvas(this,props);return new Ellipse(this,svgCanvas,x,y,rx,ry,props)},polyline:function(points,props){var svgCanvas=getSvgCanvas(this,props);return new Polyline(this,svgCanvas,points,!1,props)},polygon:function(points,props){var svgCanvas=getSvgCanvas(this,props);return new Polyline(this,svgCanvas,points,!0,props)},path:function(path,props){var svgCanvas=getSvgCanvas(this,props);return new Path(this,svgCanvas,path,props)},set:function(props){var svgCanvas=getSvgCanvas(this,props);return new Set(this,svgCanvas)}};var gTypes={JSAVGraphical:JSAVGraphical,Circle:Circle,Rect:Rect,Line:Line,Ellipse:Ellipse,Polyline:Polyline,Path:Path,Set:Set};JSAV._types.g=gTypes;var svgElements=["circle","path","rect","ellipse","line","polyline","polygon"],origWidthHook=$.cssHooks.width,origHeightHook=$.cssHooks.height;$.cssHooks.width={get:function(elem,computed,extra){return-1!==svgElements.indexOf(elem.nodeName)?elem.getBoundingClientRect().width:origWidthHook.get(elem,computed,extra)},set:origWidthHook.set},$.cssHooks.height={get:function(elem,computed,extra){return-1!==svgElements.indexOf(elem.nodeName)?elem.getBoundingClientRect().height:origHeightHook.get(elem,computed,extra)},set:origHeightHook.set},/*!
    Following utility functions for handling SVG elements add/remove/toggle/hasClass
    functions are implemented by Keith Wood. See:
   http://keith-wood.name/svg.html
   jQuery DOM compatibility for jQuery SVG
   Written by Keith Wood (kbwood{at}iinet.com.au) April 2009.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
$.svg={isSVGElem:function(node){return 1==node.nodeType&&"http://www.w3.org/2000/svg"==node.namespaceURI}},$.fn.addClass=function(origAddClass){return function(classNames){return classNames=classNames||"",this.each(function(){if($.svg.isSVGElem(this)){var node=this;$.each(classNames.split(/\s+/),function(i,className){var classes=node.className?node.className.baseVal:node.getAttribute("class");-1==$.inArray(className,classes.split(/\s+/))&&(classes+=(classes?" ":"")+className,node.className?node.className.baseVal=classes:node.setAttribute("class",classes))})}else origAddClass.apply($(this),[classNames])})}}($.fn.addClass),$.fn.removeClass=function(origRemoveClass){return function(classNames){return classNames=classNames||"",this.each(function(){if($.svg.isSVGElem(this)){var node=this;$.each(classNames.split(/\s+/),function(i,className){var classes=node.className?node.className.baseVal:node.getAttribute("class");classes=$.grep(classes.split(/\s+/),function(n){return n!=className}).join(" "),node.className?node.className.baseVal=classes:node.setAttribute("class",classes)})}else origRemoveClass.apply($(this),[classNames])})}}($.fn.removeClass),$.fn.toggleClass=function(origToggleClass){return function(className,state){return this.each(function(){$.svg.isSVGElem(this)?("boolean"!=typeof state&&(state=!$(this).hasClass(className)),$(this)[(state?"add":"remove")+"Class"](className)):origToggleClass.apply($(this),[className,state])})}}($.fn.toggleClass),$.fn.hasClass=function(origHasClass){return function(className){className=className||"";var found=!1;return this.each(function(){if($.svg.isSVGElem(this)){var classes=(this.className?this.className.baseVal:this.getAttribute("class")).split(/\s+/);found=$.inArray(className,classes)>-1}else found=origHasClass.apply($(this),[className]);return!found}),found}}($.fn.hasClass)}}(jQuery,Raphael);else{for(var error=function(){console.error("You are trying to use graphical primitives but forgot to load Raphael.js.")},g={},names=["circle","rect","line","ellipse","polyline","polygon","path","set"],i=names.length;i--;)g[names[i]]=error;JSAV.ext.g=g}!function($){"use strict";if("undefined"!=typeof JSAV){var Label=function(jsav,text,options){this.jsav=jsav,this.options=$.extend({visible:!0},options),this.element=$('<div class="jsavlabel">'+text+"</div>"),this.options.before?this.element.insertBefore(this.options.before.element):this.options.after?this.element.insertAfter(this.options.after.element):this.options.container?this.options.container.append(this.element):$(this.jsav.canvas).append(this.element),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Label,JSAV._types.JSAVObject);var labelproto=Label.prototype;labelproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible),labelproto.show=JSAV.ext.effects.show,labelproto.hide=JSAV.ext.effects.hide,labelproto._setText=JSAV.anim(function(newText){this.element.html(newText)}),labelproto.text=function(newValue,options){return"undefined"==typeof newValue?this.element.html():(this._setText(newValue,options),this)},labelproto.value=labelproto.text,labelproto.state=function(newState){if("undefined"==typeof newState){var state={t:this.text()},style=this.element.attr("style"),cls=JSAV.utils._helpers.elementClasses(this.element);return cls.length>0&&(state.cls=cls),style&&(state.css=style),state}this.text(newState.t,{record:!1}),JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]),this.element.attr("style",newState.css||"")},labelproto.equals=function(otherLabel,options){if(!(otherLabel&&otherLabel instanceof Label&&this.text()===otherLabel.text()))return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherLabel,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherLabel,options["class"]);if(!classEquals)return!1}return!0},labelproto.css=JSAV.utils._helpers.css,labelproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),labelproto.addClass=JSAV.utils._helpers.addClass,labelproto.removeClass=JSAV.utils._helpers.removeClass,labelproto.hasClass=JSAV.utils._helpers.hasClass,labelproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass),JSAV._types.Label=Label,JSAV.ext.label=function(text,options){return new Label(this,text,options)}}}(jQuery),function($){"use strict";function normalizeAngle(angle){for(var pi=Math.PI;0>angle;)angle+=2*pi;for(;angle>=2*pi;)angle-=2*pi;return angle}function lineIntersectCircle(pointa,pointb,center,radius){function interpolate(p1,p2,d){return{x:p1.x+(p2.x-p1.x)*d,y:p1.y+(p2.y-p1.y)*d}}var result={},a=(pointb.x-pointa.x)*(pointb.x-pointa.x)+(pointb.y-pointa.y)*(pointb.y-pointa.y),b=2*((pointb.x-pointa.x)*(pointa.x-center.x)+(pointb.y-pointa.y)*(pointa.y-center.y)),cc=center.x*center.x+center.y*center.y+pointa.x*pointa.x+pointa.y*pointa.y-2*(center.x*pointa.x+center.y*pointa.y)-radius*radius,deter=b*b-4*a*cc;if(0>=deter)result.inside=!1;else{var e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a);(0>u1||u1>1)&&(0>u2||u2>1)?result.inside=0>u1&&0>u2||u1>1&&u2>1?!1:!0:(u2>=0&&1>=u2&&(result.enter=interpolate(pointa,pointb,u2)),u1>=0&&1>=u1&&(result.exit=interpolate(pointa,pointb,u1)),result.intersects=!0)}return result}function getNodeBorderAtAngle(dim,targetNodeCenter,angle,radius){dim.width=Math.max(dim.width,1),dim.height=Math.max(dim.height,1);var x,y,intersect,topAngle,bottomAngle,leftAngle,rightAngle,pi=Math.PI,urCornerA=Math.atan2(2*dim.height,2*dim.width),ulCornerA=pi-urCornerA,lrCornerA=2*pi-urCornerA,llCornerA=urCornerA+pi;return radius=Math.min(radius,dim.width,dim.height),urCornerA>angle||angle>lrCornerA?(topAngle=Math.atan2(dim.height-radius,dim.width),bottomAngle=2*pi-topAngle,x=dim.x+dim.width,y=dim.y-dim.width*Math.tan(angle),radius>0&&angle>topAngle&&bottomAngle>angle&&(intersect=bottomAngle>angle&&angle>pi?lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y+dim.height-radius},radius):lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y-dim.height+radius},radius))):angle>ulCornerA&&llCornerA>angle?(topAngle=pi-Math.atan2(dim.height-radius,dim.width),bottomAngle=2*pi-topAngle,x=dim.x-dim.width,y=dim.y+dim.width*Math.tan(angle),radius>0&&(topAngle>angle||angle>bottomAngle)&&(intersect=topAngle>angle?lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y-dim.height+radius},radius):lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y+dim.height-radius},radius))):ulCornerA>=angle?(rightAngle=Math.atan2(dim.height,dim.width-radius),leftAngle=pi-rightAngle,y=dim.y-dim.height,x=dim.x+dim.height/Math.tan(angle),radius>0&&(angle>leftAngle||rightAngle>angle)&&(intersect=angle>leftAngle?lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y-dim.height+radius},radius):lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y-dim.height+radius},radius))):(leftAngle=pi+Math.atan2(dim.height,dim.width-radius),rightAngle=2*pi-Math.atan2(dim.height,dim.width-radius),y=dim.y+dim.height,x=dim.x-dim.height/Math.tan(angle),radius>0&&(leftAngle>angle||angle>rightAngle)&&(intersect=angle>rightAngle?lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y+dim.height-radius},radius):lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y+dim.height-radius},radius))),intersect&&intersect.exit&&(x=intersect.exit.x,y=intersect.exit.y),[Math.round(x),Math.round(y)]}if("undefined"!=typeof JSAV){$.fn.getstyles=function(){for(var arg,res={},i=0;i<arguments.length;i++)if(arg=arguments[i],$.isArray(arg))for(var j=0;j<arg.length;j++)res[arg[j]]=this.css(arg[j]);else res[arg]=this.css(arg);return res};var JSAVDataStructure=function(){};JSAV.utils.extend(JSAVDataStructure,JSAV._types.JSAVObject);var dsproto=JSAVDataStructure.prototype;dsproto.getSvg=function(){if(!this.svg){this.svg=new Raphael(this.element[0]),this.svg.renderfix();var style=this.svg.canvas.style;style.position="absolute"}return this.svg},dsproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible),dsproto.show=JSAV.ext.effects.show,dsproto.hide=JSAV.ext.effects.hide,dsproto.addClass=JSAV.utils._helpers.addClass,dsproto.removeClass=JSAV.utils._helpers.removeClass,dsproto.hasClass=JSAV.utils._helpers.hasClass,dsproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass),dsproto.initialize=function(){},dsproto.initializeFromElement=function(){},dsproto.clone=function(){};var Edge=function(jsav,start,end,options){this.jsav=jsav,this.startnode=start,this.endnode=end,this.options=$.extend(!0,{display:!0},options),this.container=start.container;var startPos=start?start.element.position():{left:0,top:0},endPos=end?end.element.position():{left:0,top:0};startPos.left===endPos.left&&startPos.top===endPos.top?this.g=this.jsav.g.line(-1,-1,-1,-1,$.extend({container:this.container},this.options)):(end&&(endPos.left+=end.element.outerWidth()/2,endPos.top+=end.element.outerHeight()),startPos.left||startPos.top||(startPos=endPos),this.g=this.jsav.g.line(startPos.left,startPos.top,endPos.left,endPos.top,$.extend({container:this.container},this.options))),this.element=$(this.g.rObj.node);var visible="boolean"==typeof this.options.display&&this.options.display===!0;this.g.rObj.attr({opacity:0}),this.element.addClass("jsavedge"),start&&this.element[0].setAttribute("data-startnode",this.startnode.id()),end&&this.element[0].setAttribute("data-endnode",this.endnode.id()),this.element[0].setAttribute("data-container",this.container.id()),this.element.data("edge",this),"undefined"!=typeof this.options.weight&&(this._weight=this.options.weight,this.label(this._weight)),visible&&this.g.show()};JSAV.utils.extend(Edge,JSAVDataStructure);var edgeproto=Edge.prototype;edgeproto.start=function(node){return"undefined"==typeof node?this.startnode:(this.startnode=node,this.g.rObj.node.setAttribute("data-startnode",this.startnode?this.startnode.id():""),this)},edgeproto.end=function(node){return"undefined"==typeof node?this.endnode:(this.endnode=node,this.g.rObj.node.setAttribute("data-endnode",this.endnode?this.endnode.id():""),this)},edgeproto._setweight=JSAV.anim(function(newWeight){var oldWeight=this._weight;return this._weight=newWeight,[oldWeight]}),edgeproto.weight=function(newWeight){return"undefined"==typeof newWeight?this._weight:(this._setweight(newWeight),void this.label(newWeight))},edgeproto.clear=function(){this.g.rObj.remove()},edgeproto.hide=function(options){this.g.isVisible()&&(this.g.hide(options),this._label&&this._label.hide(options))},edgeproto.show=function(options){this.g.isVisible()||(this.g.show(options),this._label&&this._label.show(options))},edgeproto.isVisible=function(){return this.g.isVisible()},edgeproto.label=function(newLabel,options){if("undefined"==typeof newLabel)return this._label&&this._label.element.filter(":visible").size()>0?this._label.text():void 0;if(this._label)this._label.text(newLabel,options);else{var self=this,_labelPositionUpdate=function(options){if(self._label){var bbox=options&&options.bbox?options.bbox:self.g.bounds(),lbbox=self._label.bounds(),newTop=bbox.top+(bbox.height-lbbox.height)/2,newLeft=bbox.left+(bbox.width-lbbox.width)/2;(newTop!==lbbox.top||newLeft||lbbox.left)&&self._label.css({top:newTop,left:newLeft},options)}};this._labelPositionUpdate=_labelPositionUpdate,this._label=this.jsav.label(newLabel,{container:this.container.element}),this._label.element.addClass("jsavedgelabel")}},edgeproto.equals=function(otherEdge,options){if(!otherEdge||!otherEdge instanceof Edge)return!1;if(!(!options||options.dontCheckNodes||this.startnode.equals(otherEdge.startnode)&&this.endnode.equals(otherEdge.endnode)))return!1;if(this._weight!==otherEdge._weight)return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherEdge,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherEdge,options["class"]);if(!classEquals)return!1}return!0},edgeproto._setcss=JSAV.anim(function(cssprop,value){var newprops,oldProps=$.extend(!0,{},cssprop),el=this.g.rObj;if("string"==typeof cssprop&&"undefined"!=typeof value)oldProps[cssprop]=el.attr(cssprop),newprops={},newprops[cssprop]=value;else{for(var i in cssprop)cssprop.hasOwnProperty(i)&&(oldProps[i]=el.attr(i));newprops=cssprop}return this.jsav._shouldAnimate()?el.animate(newprops,this.jsav.SPEED):el.attr(newprops),[oldProps]}),edgeproto.css=function(cssprop,value,options){return"string"==typeof cssprop&&"undefined"==typeof value?this.g.rObj.attr(cssprop):this._setcss(cssprop,value,options)},edgeproto.state=function(newState){if("undefined"==typeof newState){var state={a:this.g.rObj.attrs},cls=JSAV.utils._helpers.elementClasses(this.element);return cls.length>0&&(state.cls=cls),this.label()&&(state.l=this.label()),this._weight&&(state.w=this.weight()),state}this.g.css(newState.a),JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]),newState.l?this.label(newState.l,{record:!1}):this.label()&&this.label(""),newState.w?this.weight(newState.w):this.weight()&&this.weight("")},edgeproto.position=function(){var bbox=this.g.bounds();return{left:bbox.left,top:bbox.top}},edgeproto.addClass=function(className,options){return this.element.hasClass(className)?this:this.toggleClass(className,options)},edgeproto.removeClass=function(className,options){return this.element.hasClass(className)?this.toggleClass(className,options):this},edgeproto.hasClass=function(className){return this.element.hasClass(className)},edgeproto.toggleClass=JSAV.anim(function(className,options){return this.element.toggleClass(className),[className,options]}),edgeproto.highlight=function(options){this.addClass("jsavhighlight",options)},edgeproto.unhighlight=function(options){this.removeClass("jsavhighlight",options)},edgeproto.layout=function(options){var sElem=this.start().element,eElem=this.end().element,start=options&&options.start?options.start:this.start().position(),end=options&&options.end?options.end:this.end().position(),sWidth=sElem.outerWidth()/2,sHeight=sElem.outerHeight()/2,eWidth=eElem.outerWidth()/2,eHeight=eElem.outerHeight()/2,fromX=options&&options.fromPoint?options.fromPoint[0]:Math.round(start.left+sWidth),fromY=options&&options.fromPoint?options.fromPoint[1]:Math.round(start.top+sHeight),toX=Math.round(end.left+eWidth),toY=Math.round(end.top+eHeight),fromAngle=normalizeAngle(2*Math.PI-Math.atan2(toY-fromY,toX-fromX)),toAngle=normalizeAngle(2*Math.PI-Math.atan2(fromY-toY,fromX-toX)),startRadius=parseInt(sElem.css("borderBottomRightRadius"),10)||0,ADJUSTMENT_MAGIC=2.2,strokeWidth=parseInt(this.g.element.css("stroke-width"),10),startStrokeAdjust=this.options["arrow-begin"]?strokeWidth*ADJUSTMENT_MAGIC:0,fromPoint=options&&options.fromPoint?options.fromPoint:getNodeBorderAtAngle({width:sWidth+startStrokeAdjust,height:sHeight+startStrokeAdjust,x:fromX,y:fromY},{x:toX,y:toY},fromAngle,startRadius),endRadius=parseInt(eElem.css("borderBottomRightRadius"),10)||0,endStrokeAdjust=this.options["arrow-end"]?strokeWidth*ADJUSTMENT_MAGIC:0,toPoint=getNodeBorderAtAngle({width:eWidth+endStrokeAdjust,height:eHeight+endStrokeAdjust,x:toX,y:toY},{x:fromX,y:fromY},toAngle,endRadius);if(this.g.movePoints([[0].concat(fromPoint),[1].concat(toPoint)],options),$.isFunction(this._labelPositionUpdate)){var bbtop=Math.min(fromPoint[1],toPoint[1]),bbleft=Math.min(fromPoint[0],toPoint[0]),bbwidth=Math.abs(fromPoint[0]-toPoint[0]),bbheight=Math.abs(fromPoint[1]-toPoint[1]),bbox={top:bbtop,left:bbleft,width:bbwidth,height:bbheight};this._labelPositionUpdate($.extend({bbox:bbox},options))}"jsavnull"===this.start().value()||"jsavnull"===this.end().value()?this.addClass("jsavedge",options).addClass("jsavnulledge",options):this.addClass("jsavedge",options).removeClass("jsavnulledge")};var Node=function(){};JSAV.utils.extend(Node,JSAVDataStructure);var nodeproto=Node.prototype;nodeproto.value=function(newVal,options){return"undefined"==typeof newVal?JSAV.utils.value2type(this.element.attr("data-value"),this.element.attr("data-value-type")):(this._setvalue(newVal,options),this)},nodeproto._setvalue=JSAV.anim(function(newValue){var oldVal=this.value(),valtype=typeof newValue;return"undefined"==typeof oldVal&&(oldVal=""),"object"===valtype&&(valtype="string"),this.element.find(".jsavvalue").html(this._valstring(newValue)).end().attr({"data-value":newValue,"data-value-type":valtype}),[oldVal]}),nodeproto._valstring=function(value){return"<span class='jsavvaluelabel'>"+value+"</span>"},nodeproto.highlight=function(){return this.addClass("jsavhighlight")},nodeproto.unhighlight=function(){return this.removeClass("jsavhighlight")},nodeproto.isHighlight=function(){return this.hasClass("jsavhighlight")},nodeproto.state=function(newState){if("undefined"==typeof newState){var state={v:this.value()},style=this.element.attr("style"),cls=JSAV.utils._helpers.elementClasses(this.element);return cls.length>0&&(state.cls=cls),style&&(state.css=style),state}this.value(newState.v,{record:!1}),JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]),this.element.attr("style",newState.css||"")},nodeproto.css=JSAV.utils._helpers.css,nodeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),JSAV._types.ds={JSAVDataStructure:JSAVDataStructure,Edge:Edge,Node:Node},JSAV.ext.ds={layout:{}}}}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var getIndices=JSAV.utils._helpers.getIndices,templates={};templates.array='<span class="jsavvalue"><span class="jsavvaluelabel">{{value}}</span></span>',templates["array-indexed"]=templates.array+'<span class="jsavindexlabel">{{index}}</span>',templates.vertical=templates.array,templates["vertical-indexed"]=templates["array-indexed"],templates.bar='<span class="jsavvaluebar"></span>'+templates.array,templates["bar-indexed"]=templates.bar+'<span class="jsavindexlabel">{{index}}</span>';var ArrayIndex=function(container,value,index,options){this.jsav=container.jsav,this.container=container,this.index=index,this.options=$.extend(!0,{},options,{visible:!0});var indHtml=container.options.template.replace("{{value}}",value).replace("{{index}}",index),ind=$("<li class='jsavnode jsavindex'>"+indHtml+"</li>");this.element=ind,this.options.autoResize&&ind.addClass("jsavautoresize"),this.container.element.append(ind)};JSAV.utils.extend(ArrayIndex,JSAV._types.ds.Node);var indexproto=ArrayIndex.prototype;indexproto.value=function(newValue,options){return this.container.value(this.index,newValue,options)},indexproto._setvalue=indexproto.value,indexproto.show=function(){},indexproto.hide=function(){},indexproto.equals=function(otherIndex,options){if(!otherIndex||this.value()!==otherIndex.value()||!otherIndex instanceof ArrayIndex)return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherIndex,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherIndex,options["class"]);if(!classEquals)return!1}return!0};var AVArray=function(jsav,element,options){this.jsav=jsav,this.options=$.extend(!0,{autoresize:!0,center:!0,layout:"array"},options),this.options.template||(this.options.template=templates[this.options.layout+(this.options.indexed?"-indexed":"")]),this._indices=[],$.isArray(element)?this.initialize(element):element&&(this.element=$(element),this.initializeFromElement())};JSAV.utils.extend(AVArray,JSAV._types.ds.JSAVDataStructure),AVArray._templates=templates;var arrproto=AVArray.prototype;arrproto.isHighlight=function(index){return this.hasClass(index,"jsavhighlight")},arrproto.highlight=function(indices,options){return this.addClass(indices,"jsavhighlight",options),this},arrproto.unhighlight=function(indices,options){return this.removeClass(indices,"jsavhighlight",options),this},arrproto._setarraycss=JSAV.anim(function(cssprops,options){var oldProps=$.extend(!0,{},cssprops),el=this.element;if("object"!=typeof cssprops)return[cssprops];for(var i in cssprops)cssprops.hasOwnProperty(i)&&(oldProps[i]=el.css(i));return this.jsav._shouldAnimate()?this.jsav.effects.transition(this.element,cssprops,options):this.element.css(cssprops),[oldProps]}),arrproto.css=function(indices,cssprop,options){var $elems;if("string"==typeof cssprop)return $elems=getIndices($(this.element).find("li"),indices),$elems.css(cssprop);if("string"==typeof indices)return this.element.css(indices);if($.isArray(indices)||"object"!=typeof indices){for(var indArray=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),indices),i=0,l=indArray.length;l>i;i++)this._indices[indArray[i]].css(cssprop,options);return this}return this._setarraycss(indices,options)},arrproto.index=function(index){return this._indices[index]},arrproto.swap=JSAV.anim(function(index1,index2,options){var $pi1=$(this.element).find("li:eq("+index1+")"),$pi2=$(this.element).find("li:eq("+index2+")"),tmp=this._values[index1];return this._values[index1]=this._values[index2],this._values[index2]=tmp,this.jsav.effects.swap($pi1,$pi2,options),[index1,index2,options]}),arrproto.clone=function(){var vals=this._values,newArray=new AVArray(this.jsav,vals,$.extend(!0,{},this.options,{visible:!1}));return newArray.state(this.state()),newArray},arrproto.size=function(){return this.element.find("li").size()},arrproto.value=function(index,newValue,options){return"undefined"==typeof newValue?this._values[index]:this._setvalue(index,newValue,options)},arrproto._newindex=function(value,index){"undefined"==typeof value&&(value=""),"undefined"==typeof index&&(index="");var ind=new ArrayIndex(this,value,index,this.options);return this._indices[index]=ind,ind},arrproto._setvalue=JSAV.anim(function(index,newValue){for(var size=this.size(),oldval=this.value(index);index>size-1;){{this._newindex("",size)}this._values[size]="",size=this.size()}var $index=this.element.find("li:eq("+index+")");return this._values[index]=newValue,$index.find(".jsavvaluelabel").html(""+newValue),[index,oldval]}),arrproto._initOptionClasses=function(){this.options.autoresize&&this.element.addClass("jsavautoresize"),this.options.center&&this.element.addClass("jsavcenter"),this.options.indexed&&this.element.addClass("jsavindexed")},arrproto.initialize=function(data){var key,val,i,el=this.options.element||$("<ol/>");for(this.options.element||$(this.jsav.canvas).append(el),this.element=el,this._initOptionClasses(),this._values=data.slice(0),i=0;i<data.length;i++)(null===data[i]||void 0===data[i])&&(this._values[i]="");el.addClass("jsavarray"),this.options=jQuery.extend({visible:!0},this.options);for(key in this.options)this.options.hasOwnProperty(key)&&(val=this.options[key],("string"==typeof val||"number"==typeof val||"boolean"==typeof val)&&el.attr("data-"+key,val));for(i=0;i<data.length;i++)this._newindex(data[i],i);JSAV.utils._helpers.handlePosition(this),this.layout(),el.css("display","none"),JSAV.utils._helpers.handleVisibility(this,this.options)},arrproto.initializeFromElement=function(){if(this.element){var $elem=this.element,$elems=$elem.find("li"),data=$elem.data(),that=this;for(var key in data)data.hasOwnProperty(key)&&(this.options[key]=data[key]);$elem.addClass("jsavarray"),this._initOptionClasses(),this._values=[],$elems.each(function(index){{var $this=$(this),value=JSAV.utils.value2type($this.attr("data-value")||$this.html(),$this.attr("data-value-type")||"string");that._newindex(value,index)}that._values[index]=value,$this.remove()}),this.layout()}},arrproto.layout=function(options){var layoutAlg=this.options.layout||"_default";return this.element.removeClass("jsavbararray"),this.jsav.ds.layout.array[layoutAlg](this,options)},arrproto.state=function(newstate){if(!newstate){for(var state={ind:[]},indices=state.ind,i=0,l=this._indices.length;l>i;i++)indices.push(this._indices[i].state());var style=this.element.attr("style");style&&(state.style=style);var cls=JSAV.utils._helpers.elementClasses(this.element);return cls.length>0&&(state.classes=cls),state}this.element.attr("style",newstate.style||""),JSAV.utils._helpers.setElementClasses(this.element,newstate.classes||[]);for(var currIndices=this._indices,newIndices=newstate.ind,i=0,curr=currIndices.length,newl=newIndices.length;curr>i&&newl>i;i++)currIndices[i].state(newIndices[i]);for(;curr>i;){var lastInd=currIndices.length-1;currIndices[lastInd].element.remove(),currIndices.splice(lastInd),this._values.splice(lastInd),i++}for(;newl>i;){var newInd=this._newindex("",i);newInd.state(newIndices[i]),i++}},arrproto.equals=function(otherArray,options){var i,j,equal,cssprop,clazzname,len,opts=options||{};if(!$.isArray(otherArray)){if(len=otherArray.size(),this.size()!==len)return!1;if(!("value"in opts)||opts.value)for(i=0;len>i;i++)if(equal=this.value(i)==otherArray.value(i),!equal)return!1;if("css"in opts)if($.isArray(opts.css)){for(i=0;i<opts.css.length;i++)for(cssprop=opts.css[i],j=0;len>j;j++)if(equal=this.css(j,cssprop)===otherArray.css(j,cssprop),!equal)return!1}else for(cssprop=opts.css,i=0;len>i;i++)if(equal=this.css(i,cssprop)===otherArray.css(i,cssprop),!equal)return!1;if("class"in opts)if($.isArray(opts["class"])){for(i=0;i<opts["class"].length;i++)for(clazzname=opts["class"][i],j=0;len>j;j++)if(equal=this.hasClass(j,clazzname)===otherArray.hasClass(j,clazzname),!equal)return!1}else for(clazzname=opts["class"],i=0;len>i;i++)if(equal=this.hasClass(i,clazzname)===otherArray.hasClass(i,clazzname),!equal)return!1;return!0}if(!options){if(len=otherArray.length,this.size()!==len)return!1;for(i=0;len>i;i++)if(equal=this.value(i)==otherArray[i],!equal)return!1;return!0}if("css"in opts){for(cssprop=opts.css,i=0;len>i;i++)if(equal=this.css(i,cssprop)===otherArray[i],!equal)return!1;return!0}return!1},arrproto.toggleClass=JSAV.anim(function(index,className,options){var $elems=getIndices($(this.element).find("li.jsavindex"),index);return this.jsav._shouldAnimate()?this.jsav.effects._toggleClass($elems,className,options):$elems.toggleClass(className),[index,className,options]}),arrproto.addClass=function(index,className,options){var indices=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),index,":not(."+className+")");return indices.length>0?this.toggleClass(indices,className,options):this},arrproto.removeClass=function(index,className,options){var indices=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),index,"."+className);return indices.length>0?this.toggleClass(indices,className,options):this},arrproto.hasClass=function(index,className){var $elems=getIndices($(this.element).find("li.jsavindex"),index);return $elems.hasClass(className)},arrproto.isEmpty=function(){for(var i=0;i<this.size();i++)if(""!==this.value(i))return!1;return!0};for(var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"],eventhandler=function(eventType){return function(data,handler){var self=this;return this.element.on(eventType,".jsavindex",function(e){var index=self.element.find(".jsavindex").index(this);if(self.jsav.logEvent({type:"jsav-array-"+eventType,arrayid:self.id(),index:index}),$.isFunction(data))data.call(self,index,e);else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.unshift(index),params.push(e),handler.apply(self,params)}}),this}},i=events.length;i--;)arrproto[events[i]]=eventhandler(events[i]);arrproto.on=function(eventName,data,handler){return eventhandler(eventName).call(this,data,handler),this},arrproto.toggleArrow=function(indices,options){this.toggleClass(indices,"jsavarrow",options)},arrproto.toggleLine=JSAV.anim(function(index,options){if("bar"===this.options.layout){var valelem=this.element.find("li .jsavvalue").eq(index),lielem=valelem.parent();if(0!==valelem.size()){var opts=$.extend({startIndex:0,endIndex:this.size()-1},options),$mark=lielem.find(".jsavmark"),$markline=lielem.find(".jsavmarkline");if(0===$markline.size()&&0===$mark.size()){if(null!==opts.markStyle&&($mark=$("<div class='jsavmark' />"),lielem.prepend($mark),opts.markStyle&&$mark.css(opts.markStyle),$mark.css({bottom:valelem.height()-$mark.outerHeight()/2,left:valelem.position().left+valelem.width()/2-$mark.outerWidth()/2,display:"block"})),null!==opts.lineStyle){$markline=$("<div class='jsavmarkline' />"),lielem.prepend($markline),opts.lineStyle&&$markline.css(opts.lineStyle);var startelem=this.element.find("li:eq("+opts.startIndex+")"),endelem=this.element.find("li:eq("+opts.endIndex+")");$markline.css({width:endelem.position().left-startelem.position().left+endelem.width(),left:startelem.position().left-lielem.position().left,bottom:valelem.height()-$markline.outerHeight()/2,display:"block"})}}else $mark.remove(),$markline.remove();return[index,opts]}}}),JSAV._types.ds.AVArray=AVArray,JSAV._types.ds.ArrayIndex=ArrayIndex,JSAV.ext.ds.array=function(element,options){return new AVArray(this,element,options)}}}(jQuery),function($){"use strict";function setArrayWidth(array){var width=0;array.element.find("li").each(function(){width+=$(this).outerWidth(!0)}),width!==array.element.width()&&array.css({width:width+1+"px"})}function horizontalArray(array,options){var $arr=$(array.element).addClass("jsavhorizontalarray"),$items=$arr.find("li"),maxHeight=-1;$items.each(function(){var $i=$(this);maxHeight=Math.max(maxHeight,$i.outerHeight())}),$arr.height(maxHeight+(array.options.indexed?30:0)),setArrayWidth(array,$items.last(),options);var arrPos=$arr.position();return{width:$arr.outerWidth(),height:$arr.outerHeight(),left:arrPos.left,top:arrPos.top}}function verticalArray(array,options){var $arr=$(array.element).addClass("jsavverticalarray"),$items=$arr.find("li"),maxWidth=-1,indexed=!!array.options.indexed;indexed&&($items.each(function(){var $i=$(this),$indexLabel=$i.find(".jsavindexlabel");maxWidth=Math.max(maxWidth,$indexLabel.innerWidth()),$indexLabel.css({top:$i.innerHeight()/2-$indexLabel.outerHeight()/2})}),$items.css("margin-left",maxWidth)),setArrayWidth(array,$items.last(),options);var arrPos=$arr.position();return{width:$arr.outerWidth(),height:$arr.outerHeight(),left:arrPos.left,top:arrPos.top}}function barArray(array,options){for(var $arr=$(array.element).addClass("jsavbararray"),$items=$arr.find("li.jsavindex"),maxValue=Number.MIN_VALUE,size=($items.first().outerWidth(),array.size()),i=0;size>i;i++)maxValue=Math.max(maxValue,array.value(i));maxValue*=1.15;var setBarHeight=JSAV.anim(function(elem,newHeight,options){var oldHeight=elem.height();return this.jsav._shouldAnimate()?this.jsav.effects.transition(elem,{height:newHeight},options):elem.css({height:newHeight}),[elem,oldHeight]});return $items.each(function(index){var $i=$(this),$valueBar=$i.find(".jsavvaluebar"),$value=$i.find(".jsavvalue"),valueBarHeight=$valueBar.height(),newBarHeight=Math.round(valueBarHeight*(array.value(index)/maxValue));newBarHeight!==$value.height()&&setBarHeight.call(array,$value,newBarHeight)}),setArrayWidth(array,$items.last(),options),{width:array.element.outerWidth(),height:array.element.outerHeight(),left:array.position().left,top:array.position().top}}JSAV.ext.ds.layout.array={_default:horizontalArray,bar:barArray,array:horizontalArray,vertical:verticalArray}}(jQuery),function($){"use strict";function setchild(self,pos,node,options){var other,newchildnodes,oPos=pos?0:1,child=self.child(pos),oChild=self.child(oPos),opts=$.extend({hide:!0},options);if("undefined"==typeof node)return child&&"jsavnull"!==child.value()?child:void 0;var nullopts=$.extend({},opts);if(nullopts.edgeLabel=void 0,null!==node){if(node instanceof self.constructors.Node)node.parent()&&node.parent()!==self&&node.remove({hide:!1}),node.parent(self);else{if(child&&("number"==typeof node||"string"==typeof node))return child.value(node,opts);node=self.container.newNode(node,self,opts)}return node.element.attr("data-binchildrole",pos?"right":"left"),newchildnodes=[],newchildnodes[pos]=node,child&&opts.hide&&child.hide(),oChild?newchildnodes[oPos]=oChild:(other=self.container.newNode("jsavnull",self,nullopts),other.element.addClass("jsavnullnode").attr("data-binchildrole",oPos?"right":"left"),newchildnodes[oPos]=other),self._setchildnodes(newchildnodes,opts),node
}return child&&"jsavnull"!==child.value()&&(child.parent(null,opts),oChild&&"jsavnull"!==oChild.value()?(other=self.container.newNode("jsavnull",self,nullopts),other.element.addClass("jsavnullnode").attr("data-binchildrole",pos?"right":"left"),opts.hide&&child.hide(),newchildnodes=[],newchildnodes[pos]=other,newchildnodes[oPos]=oChild,self._setchildnodes(newchildnodes,opts)):(opts.hide&&child.hide(),oChild&&oChild.hide(),self._setchildnodes([]))),child}if("undefined"!=typeof JSAV){var Edge=JSAV._types.ds.Edge,Tree=function(jsav,options){this.init(jsav,options)};JSAV.utils.extend(Tree,JSAV._types.ds.JSAVDataStructure);var treeproto=Tree.prototype;treeproto.init=function(jsav,options){this._layoutDone=!1,this.jsav=jsav,this.options=options;var el=this.options.element||$("<div/>");el.addClass("jsavtree jsavcommontree");for(var key in this.options){var val=this.options[key];(this.options.hasOwnProperty(key)&&"string"==typeof val||"number"==typeof val||"boolean"==typeof val)&&el.attr("data-"+key,val)}this.options.element||$(this.jsav.canvas).append(el),this.element=el,this.options.autoresize&&this.element.addClass("jsavautoresize"),JSAV.utils._helpers.handlePosition(this),this.constructors=$.extend({Tree:Tree,Node:TreeNode,Edge:Edge},this.options.constructors),this.rootnode=this.newNode("",null),this.element.attr({"data-root":this.rootnode.id(),id:this.id()}),this.rootnode.element.attr("data-child-role","root"),JSAV.utils._helpers.handleVisibility(this,this.options)},treeproto._setrootnode=JSAV.anim(function(node){var oldroot=this.rootnode;return this.rootnode=node,this.element.attr("data-root",node.id()),node.element.attr("data-child-role","root"),node.element.removeAttr("data-parent data-binchildrole data-child-pos"),oldroot&&oldroot.element.removeAttr("data-child-role"),[oldroot]}),treeproto.root=function(newRoot,options){var opts=$.extend({hide:!0},options);if("undefined"==typeof newRoot)return this.rootnode;if(newRoot instanceof this.constructors.Node){var oldroot=this.rootnode;this._setrootnode(newRoot,options),this.rootnode.edgeToParent(null),opts.hide&&oldroot&&oldroot.hide()}else this.rootnode?this.rootnode.value(newRoot,options):this._setrootnode(this.newNode(newRoot,null,options),options);return this.rootnode},treeproto.clear=function(){this.root().clear(),this.element.remove()},treeproto.newNode=function(value,parent,options){return new this.constructors.Node(this,value,parent,options)},treeproto.height=function(){return this.rootnode.height()},treeproto.layout=function(options){var layoutAlg=this.options.layout||"_default";return this.jsav.ds.layout.tree[layoutAlg](this,options)},treeproto.equals=function(otherTree,options){return!otherTree instanceof this.constructors.Tree?!1:this.root().equals(otherTree.root(),options)},treeproto.css=JSAV.utils._helpers.css,treeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),treeproto.show=function(options){0===this.element.filter(":visible").size()&&this._toggleVisible(options);var opts=$.extend({recursive:!0},options);return opts.recursive&&this.root().show(options),this},treeproto.hide=function(options){this.element.filter(":visible").size()>0&&this._toggleVisible(options);var opts=$.extend({recursive:!0},options);return opts.recursive&&this.root().hide(options),this},treeproto.state=function(newState){if("undefined"==typeof newState){var nodeState=function(node){if(!node)return null;var state=node.state(),children=node.children();if(children.length>0){state.children=[];for(var i=0;i<children.length;i++)state.children.push(nodeState(node.child(i)))}return state};return nodeState(this.root())}var tree=this,setNodeState=function(node,newState){node.state(newState);for(var newChildren=newState.children||[],children=node.children(),pos=0,newChildState=newChildren[pos],child=children[pos];newChildState&&child;)setNodeState(child,newChildState),pos++,newChildState=newChildren[pos],child=children[pos];if(newChildren.length>children.length)for(;pos<newChildren.length;){var newChildNode=tree.newNode("",node,{record:!1});node.addChild(newChildNode),setNodeState(newChildNode,newChildren[pos]),pos++}else for(;pos<children.length;)node.child(pos).remove({record:!1}),children=node.children()};setNodeState(this.root(),newState)},JSAV.utils._events._addEventSupport(treeproto);var TreeNode=function(container,value,parent,options){this.init(container,value,parent,options)};JSAV.utils.extend(TreeNode,JSAV._types.ds.Node);var nodeproto=TreeNode.prototype;nodeproto.init=function(container,value,parent,options){this.jsav=container.jsav,this.container=container,this.parentnode=parent,this.options=$.extend(!0,{visible:!0},parent?parent.options:{},options),this.constructors=$.extend({},container.constructors,this.options.constructors);var el=this.options.nodeelement||$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span></div>"),valtype=typeof value;"object"===valtype&&(valtype="string"),this.element=el,el.addClass("jsavnode jsavtreenode").attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this),parent&&el.attr("data-parent",parent.id()),this.options.autoResize&&el.addClass("jsavautoresize"),this.container.element.append(el),JSAV.utils._helpers.handleVisibility(this,this.options),parent&&(this._edgetoparent=new this.constructors.Edge(this.jsav,this,parent),this.options.edgeLabel&&this._edgetoparent.label(this.options.edgeLabel)),this.childnodes=[]},nodeproto._valstring=function(value){var valstr="<span class='jsavvaluelabel'>";return"jsavnull"===value?valstr+"</span>":valstr+value+"</span>"},nodeproto._setparent=JSAV.anim(function(newParent,options){var oldParent=this.parentnode;return this._edgetoparent.end(newParent,options),options&&options.edgeLabel&&this._edgetoparent.label(options.edgeLabel,options),this.element.attr("data-parent",newParent?newParent.id():""),this.parentnode=newParent,[oldParent,options]}),nodeproto.parent=function(newParent,options){return"undefined"==typeof newParent?this.parentnode:(this._edgetoparent||this._setEdgeToParent(new this.constructors.Edge(this.jsav,this,newParent,options)),this._setparent(newParent,options),this.isVisible()&&newParent&&newParent.isVisible()&&!this._edgetoparent.isVisible()?this._edgetoparent.show():this.isVisible()&&newParent&&newParent.isVisible()||!this._edgetoparent.isVisible()||(!options||"undefined"==typeof options.hide||options.hide)&&this._edgetoparent.hide(),this)},nodeproto._setEdgeToParent=JSAV.anim(function(edge,options){var oldEdge=this._edgetoparent;return this._edgetoparent=edge,[oldEdge,options]}),nodeproto.edgeToParent=function(edge,options){return"undefined"==typeof edge?this._edgetoparent:(!edge&&this._edgetoparent&&this._edgetoparent.hide(),this._setEdgeToParent(edge,options))},nodeproto.edgeToChild=function(pos){var child=this.child(pos);return child?child.edgeToParent():void 0},nodeproto.clear=function(){this.edgeToParent()&&this.edgeToParent().clear();for(var ch=this.children(),i=ch.length;i--;)ch[i]&&ch[i].clear();this.childnodes=[],this.element.remove()},nodeproto.addChild=function(node,options){var pos=this.childnodes.length;return this.child(pos,node,options)},nodeproto._setchildnodes=JSAV.anim(function(newchildren,options){var oldChildren=this.childnodes;return this.childnodes=newchildren,$.each(newchildren,function(index,n){n.element.attr("data-child-pos",index)}),[oldChildren,options]});var setchildhelper=function(self,pos,node,options){var oldval=self.childnodes[pos],opts=$.extend({hide:!0},options);if(oldval&&(opts.hide&&oldval.hide(),oldval.parent(null,opts)),node){var newchildnodes=self.childnodes.slice(0);newchildnodes[pos]=node,node.parent()&&node.parent()!==self&&node.remove({hide:!1}),node.parent(self),self._setchildnodes(newchildnodes,opts)}else self._setchildnodes($.map(self.childnodes,function(item,index){return index!==pos?item:null}),opts);return self};nodeproto.child=function(pos,node,options){return"undefined"==typeof node?this.childnodes[pos]:(null===node||node instanceof this.constructors.Node||(node=this.container.newNode(node,this,options)),setchildhelper(this,pos,node,options))},nodeproto.remove=function(options){if(this===this.container.rootnode)return this.container.root(this.container.newNode("",null),options),this;for(var parent=this.parent(),children=parent.children(),i=0,l=children.length;l>i;i++)if(children[i]===this)return parent.child(i,null,options);return this},nodeproto.height=function(){for(var chs=this.children(),maxheight=0,max=Math.max,i=0,l=chs.length;l>i;i++)chs[i]&&(maxheight=max(maxheight,chs[i].height()));return maxheight+1},nodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value())return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals)return!1}if(this.edgeToParent()){var edgeEquals=this.edgeToParent().equals(otherNode.edgeToParent(),$.extend({},options,{dontCheckNodes:!0}));if(!edgeEquals)return!1}var ch=this.children(),och=otherNode.children();if(ch.length!==och.length)return!1;for(var j=0,l=ch.length;l>j;j++)if(ch[j]&&och[j]&&!ch[j].equals(och[j],options))return!1;return!0},nodeproto.children=function(){return this.childnodes},nodeproto.show=function(options){0===this.element.filter(":visible").size()&&this._toggleVisible(options);var opts=$.extend({recursive:!0},options);if(this._edgetoparent&&this._edgetoparent.show(),opts.recursive){var ch=this.children();if(ch)for(var i=0,l=ch.length;l>i;i++)ch[i].show(options)}return this},nodeproto.hide=function(options){var ch,i,l,opts=$.extend({recursive:!0},options);if(this.element.filter(":visible").size()>0&&this._toggleVisible(options),this._edgetoparent&&this._edgetoparent.hide(options),opts.recursive){if(ch=this.children())for(i=0,l=ch.length;l>i;i++)ch[i].hide(options)}else if(ch=this.children())for(i=0,l=ch.length;l>i;i++)ch[i].edgeToParent().hide(options);return this};var BinaryTree=function(jsav,options){var opts=$.extend({constructors:{Tree:BinaryTree,Node:BinaryTreeNode,Edge:Edge}},options);this.init(jsav,opts),this.element.addClass("jsavbinarytree")};JSAV.utils.extend(BinaryTree,Tree);var bintreeproto=BinaryTree.prototype;bintreeproto.state=function(newState){if("undefined"==typeof newState){var nodeState=function(node){if(!node)return null;var state=node.state();return node.left()&&(state.left=nodeState(node.left())),node.right()&&(state.right=nodeState(node.right())),state};return nodeState(this.root())}var tree=this,setNodeState=function(node,state){node.state(state);var setChild=function(childName){var child=node[childName]();if(child||state[childName])if(child&&state[childName])setNodeState(child,state[childName]);else if(child)node[childName](null,{record:!1});else{var newNode=tree.newNode("",node,{record:!1});node[childName](newNode,{record:!1}),setNodeState(newNode,state[childName])}};setChild("left"),setChild("right")};setNodeState(this.root(),newState)};var BinaryTreeNode=function(container,value,parent,options){this.init(container,value,parent,options),this.element.addClass("jsavbinarynode")};JSAV.utils.extend(BinaryTreeNode,TreeNode);var binnodeproto=BinaryTreeNode.prototype;binnodeproto.addChild=function(node,options){var pos=-1;if(this.left()){if(this.right())return void console.error("Binarytree node already has two children, cannot add more");pos=1}else pos=0;return this.child(pos,node,options)},binnodeproto.left=function(node,options){return setchild(this,0,node,options)},binnodeproto.right=function(node,options){return setchild(this,1,node,options)},binnodeproto.child=function(pos,node,options){return"undefined"==typeof node?this.childnodes[pos]:(("string"==typeof node||"number"==typeof node)&&(node=this.container.newNode(node,this,options)),setchild(this,pos,node,options))},binnodeproto.remove=function(options){if(this===this.container.rootnode)return this.container.root(this.container.newNode("",null),options),this;var parent=this.parent();return parent.left()===this?setchild(parent,0,null,options):parent.right()===this?setchild(parent,1,null,options):void 0},binnodeproto.edgeToLeft=function(){return this.edgeToChild(0)},binnodeproto.edgeToRight=function(){return this.edgeToChild(1)},binnodeproto._setvalue=JSAV.anim(function(newValue){var oldVal=this.value(),valtype=typeof newValue;return"undefined"==typeof oldVal&&(oldVal=""),"object"===valtype&&(valtype="string"),this.element.removeClass("jsavnullnode").find(".jsavvalue").html(this._valstring(newValue)).end().attr({"data-value":newValue,"data-value-type":valtype}),"jsavnull"===newValue&&this.element.addClass("jsavnullnode"),[oldVal]});var dstypes=JSAV._types.ds;dstypes.Tree=Tree,dstypes.TreeNode=TreeNode,dstypes.BinaryTree=BinaryTree,dstypes.BinaryTreeNode=BinaryTreeNode,JSAV.ext.ds.tree=function(options){return new Tree(this,$.extend(!0,{visible:!0,autoresize:!0},options))},JSAV.ext.ds.binarytree=function(options){return new BinaryTree(this,$.extend(!0,{visible:!0,autoresize:!0},options))},JSAV.ext.ds.edge=function(options){return new Edge(this,$.extend(!0,{},options))}}}(jQuery),function($){"use strict";function treeLayout(tree,options){var opts=$.extend({},tree.options,options),NODEGAP=opts.nodegap||40,results={},compactArray=function(arr){return $.map(arr,function(item){return item||null})},calculateLayout=function(node){for(var ch=compactArray(node.children()),i=0,l=ch.length;l>i;i++)ch[i]&&calculateLayout(ch[i]);results[node.id()]={cachedTranslation:{width:0,height:0},translation:{width:0,height:0},node:node},calculateContours(node)},calculateContours=function(node){var children=compactArray(node.children()),resnode=results[node.id()],nodeWidth=node.element.outerWidth()/2,nodeHeight=node.element.outerHeight();if(0===children.length)resnode.contours=new TreeContours(-nodeWidth,nodeWidth+(nodeWidth%2===0?0:1),nodeHeight,node.value()),translateThisNode(node,-nodeWidth,0);else{var transSum=0,firstChild=children[0];resnode.contours=results[firstChild.id()].contours,results[firstChild.id()].contours=null,translateNodes(firstChild,0,NODEGAP+nodeHeight);for(var i=1,l=children.length;l>i;i++){var child=children[i];if(child){var childC=results[child.id()].contours,trans=resnode.contours.calcTranslation(childC,NODEGAP);transSum+=trans,results[child.id()].contours=null,resnode.contours.joinWith(childC,trans),translateNodes(child,getXTranslation(firstChild)+trans-getXTranslation(child),NODEGAP+nodeHeight)}}var rootTrans=transSum/children.length;resnode.contours.addOnTop(-nodeWidth,nodeWidth+(nodeWidth%2===0?0:1),nodeHeight,NODEGAP,rootTrans),translateThisNode(node,getXTranslation(firstChild)+rootTrans,0)}},translateThisNode=function(node,x,y){var restrans=results[node.id()].translation;restrans.width+=x,restrans.height+=y},translateNodes=function(node,x,y){if(node){var restrans=results[node.id()].cachedTranslation;restrans||(restrans={width:0,height:0},results[node.id()].cachedTranslation=restrans),restrans.width+=x,restrans.height+=y}},getXTranslation=function(node){var restrans=results[node.id()].cachedTranslation;return results[node.id()].translation.width+(restrans?restrans.width:0)},propagateTranslations=function(node){if(node){var noderes=results[node.id()];if(noderes.cachedTranslation){for(var ch=compactArray(node.children()),i=0,l=ch.length;l>i;i++){var child=ch[i];translateNodes(child,noderes.cachedTranslation.width,noderes.cachedTranslation.height),propagateTranslations(child)}noderes.translation.width+=noderes.cachedTranslation.width,noderes.translation.height+=noderes.cachedTranslation.height,noderes.cachedTranslation=null}}},root=tree.root();calculateLayout(root),translateNodes(root,20,10+NODEGAP),propagateTranslations(root);var maxX=-Number.MAX_VALUE,maxY=-Number.MAX_VALUE,minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,max=Math.max,min=Math.min;$.each(results,function(key,value){maxX=max(maxX,value.translation.width+value.node.element.outerWidth()),maxY=max(maxY,value.translation.height+value.node.element.outerHeight()),minX=min(minX,value.translation.width),minY=min(minY,value.translation.height)}),opts.boundsOnly||$.each(results,function(key,value){var oldPos=value.node.element.position();value.node._layoutDone||0!==oldPos.left||0!==oldPos.top?value.node.moveTo(value.translation.width-minX,value.translation.height-minY):(value.node.element.css({left:value.translation.width-minX+"px",top:value.translation.height-minY+"px"}),value.node._layoutDone=!0)});var centerTree=function(tree,width){if(opts.hasOwnProperty("center")&&!opts.center)return 0;var containerWidth=$(tree.jsav.canvas).width(),treeLeft=parseInt(tree.element.css("left"),10)||0;return Math.max(0,(containerWidth-width)/2)-treeLeft},treeDims={width:maxX-minX,height:maxY-minY},left=centerTree(tree,maxX-minX);return opts.boundsOnly||(tree._layoutDone?(tree.css(treeDims,opts),left&&tree.translateX(left)):(tree._layoutDone=!0,tree.element.css(treeDims),left&&tree.element.css("left",left)),$.each(results,function(key,value){var node=value.node;if(node._edgetoparent){var start={left:value.translation.width-minX,top:value.translation.height-minY},endnode=results[node.parent().id()].translation,end={left:endnode.width-minX,top:endnode.height-minY};node._edgetoparent.layout($.extend({start:start,end:end},opts))}})),$.extend({top:tree.position().top},treeDims)}var layouts=JSAV.ext.ds.layout;layouts.tree={_default:treeLayout};var TreeContours=function(left,right,height){this.cHeight=height,this.leftCDims=[],this.leftCDims[this.leftCDims.length]={width:-left,height:height},this.cLeftExtent=left,this.rightCDims=[],this.rightCDims[this.rightCDims.length]={width:-right,height:height},this.cRightExtent=right};TreeContours.prototype={addOnTop:function(left,right,height,addHeight,originTrans){var lCD=this.leftCDims,rCD=this.rightCDims;lCD[lCD.length-1].height+=addHeight,lCD[lCD.length-1].width+=originTrans+left,rCD[rCD.length-1].height+=addHeight,rCD[rCD.length-1].width+=originTrans+right,lCD.push({width:-left,height:height}),rCD.push({width:-right,height:height}),this.cHeight+=height+addHeight,this.cLeftExtent-=originTrans,this.cRightExtent-=originTrans,left<this.cLeftExtent&&(this.cLeftExtent=left),right>this.cRightExtent&&(this.cRightExtent=right)},joinWith:function(other,hDist){var thisCDisp,otherCDisp,middle;if(other.cHeight>this.cHeight){var newLeftC=[],otherLeft=other.cHeight-this.cHeight;thisCDisp=0,otherCDisp=0,$.each(other.leftCDims,function(index,item){if(otherLeft>0){var dim={width:item.width,height:item.height};otherLeft-=item.height,0>otherLeft&&(dim.height+=otherLeft),newLeftC[newLeftC.length]=dim}else otherCDisp+=item.width}),middle=newLeftC[newLeftC.length-1],$.each(this.leftCDims,function(index,item){thisCDisp+=item.width,newLeftC[newLeftC.length]={width:item.width,height:item.height}}),middle.width-=thisCDisp-otherCDisp,middle.width-=hDist,this.leftCDims=newLeftC}if(other.cHeight>=this.cHeight)this.rightCDims=other.rightCDims.slice();else{var thisLeft=this.cHeight-other.cHeight,nextIndex=0;thisCDisp=0,otherCDisp=0,$.each(this.rightCDims,function(index,item){thisLeft>0?(nextIndex++,thisLeft-=item.height,0>thisLeft&&(item.height+=thisLeft)):thisCDisp+=item.width});for(var i=nextIndex+1,l=this.rightCDims.length;l>i;i++)this.rightCDims[i]=null;for(this.rightCDims=$.map(this.rightCDims,function(item){return item}),middle=this.rightCDims[nextIndex],i=0,l=other.rightCDims.length;l>i;i++){var item=other.rightCDims[i];otherCDisp+=item.width,this.rightCDims[this.rightCDims.length]={width:item.width,height:item.height}}middle.width+=thisCDisp-otherCDisp,middle.width+=hDist}this.rightCDims[this.rightCDims.length-1].width-=hDist,other.cHeight>this.cHeight&&(this.cHeight=other.cHeight),other.cLeftExtent+hDist<this.cLeftExtent&&(this.cLeftExtent=other.cLeftExtent+hDist),other.cRightExtent+hDist>this.cRightExtent&&(this.cRightExtent=other.cRightExtent+hDist)},calcTranslation:function(other,wantedDist){for(var ld,rd,lc=this.rightCDims,rc=other.leftCDims,li=lc.length-1,ri=rc.length-1,lCumD={width:0,height:0},rCumD={width:0,height:0},displacement=wantedDist;;){if(0>li){if(0>ri||rCumD.height>=lCumD.height)break;rd=rc[ri],rCumD.height+=rd.height,rCumD.width+=rd.width,ri--}else if(0>ri){if(lCumD.height>=rCumD.height)break;ld=lc[li],lCumD.height+=ld.height,lCumD.width+=ld.width,li--}else{ld=lc[li],rd=rc[ri];var leftNewHeight=lCumD.height,rightNewHeight=rCumD.height;rightNewHeight>=leftNewHeight&&(lCumD.height+=ld.height,lCumD.width+=ld.width,li--),leftNewHeight>=rightNewHeight&&(rCumD.height+=rd.height,rCumD.width+=rd.width,ri--)}displacement<rCumD.width-lCumD.width+wantedDist&&(displacement=rCumD.width-lCumD.width+wantedDist)}return displacement}}}(jQuery),function($){"use strict";function centerList(list,width){if(list.options.hasOwnProperty("center")&&!list.options.center)return 0;var containerWidth=$(list.jsav.canvas).width();return(containerWidth-width)/2-list.position().left}if("undefined"!=typeof JSAV){var Edge=JSAV._types.ds.Edge,List=function(jsav,options){this.jsav=jsav,this.options=$.extend({visible:!0,nodegap:40,autoresize:!0},options);var el=this.options.element||$("<div/>");el.addClass("jsavlist");for(var key in this.options){var val=this.options[key];(this.options.hasOwnProperty(key)&&"string"==typeof val||"number"==typeof val||"boolean"==typeof val)&&el.attr("data-"+key,val)}this.options.element||$(jsav.canvas).append(el),this.element=el,this.element.attr({id:this.id()}),this.options.autoresize&&el.addClass("jsavautoresize"),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(List,JSAV._types.ds.JSAVDataStructure);var listproto=List.prototype;listproto.first=function(newFirst,options){return"undefined"==typeof newFirst?this._first:this.addFirst(newFirst,options)},listproto._setfirst=JSAV.anim(function(newFirst){var oldFirst=this._first;return this._first=newFirst,[oldFirst]}),listproto.add=function(index,newValue,options){if(0>index||index>this.size())return this;if(0===index)return this.addFirst(newValue,options);var newNode,node=this.get(index-1);return newNode=newValue instanceof ListNode?newValue:this.newNode(newValue),node&&(newNode.next(node.next(),options),node.next(newNode,options)),this},listproto.addFirst=function(newValue,options){return newValue instanceof ListNode?(newValue.next(this._first,options),this._setfirst(newValue,options)):this._setfirst(this.newNode(newValue,$.extend({},options,{first:!0,next:this._first})),options),this},listproto.last=function(newLast,options){if("undefined"==typeof newLast){for(var curNode=this.first();curNode&&curNode.next();)curNode=curNode.next();return curNode}this.addLast(newLast,options)},listproto.addLast=function(newValue,options){var newNode,last=this.last();return"undefined"==typeof last?(this.first(newValue),this):(newNode=newValue instanceof ListNode?newValue:this.newNode(newValue),last.next(newNode,options),this)},listproto.get=function(index){if(!("number"!=typeof index||0>index)){for(var curNode=this.first(),pos=0;curNode.next()&&index>pos;)curNode=curNode.next(),pos++;return pos===index?curNode:void 0}},listproto.newNode=function(value,options){return new ListNode(this,value,$.extend({first:!1},this.options,options))},listproto.remove=function(index,options){var opts=$.extend({hide:!0},options);if(0===index)return this.removeFirst(options);if(index===this.size()-1)return this.removeLast(options);var prev=this.get(index-1),next=this.get(index+1),oldNode=prev.next();return prev.next(next,options),opts.hide&&(oldNode.hide(),oldNode.edgeToNext().hide()),oldNode},listproto.removeFirst=function(options){if(!(this.size()<=0)){var opts=$.extend({hide:!0},options),oldFirst=this.first();return this._setfirst(oldFirst.next(),options),opts.hide&&(oldFirst.hide(),oldFirst.edgeToNext()&&oldFirst.edgeToNext().hide()),oldFirst}},listproto.removeLast=function(options){if(this.size()<=1)return this.removeFirst();var opts=$.extend({hide:!0},options),newLast=this.get(this.size()-2),oldLast=this.last();return newLast.next(null,options),opts.hide&&(oldLast.hide(),newLast.edgeToNext().hide()),oldLast},listproto.layout=function(options){var layoutAlg=$.extend({},this.options,options).layout||"_default";return this.jsav.ds.layout.list[layoutAlg](this,options)},listproto.state=function(newState){if("undefined"==typeof newState){for(var edge,state={},node=this.first(),nodes=[],edges=[];node;)nodes.push(node.state()),edge=node.edgeToNext(),edge&&edges.push(edge.state()),node=node.next();return state.n=nodes,state.e=edges,state}if(0!==newState.n.length){for(var currNode=this.first(),i=0,newCurrState=newState.n[i];newCurrState&&currNode;)currNode.state(newCurrState),currNode=currNode.next(),newCurrState=++i<newState.n.length?newState.n[i]:null;if(currNode)for(;currNode!==this.last();)this.removeLast({record:!1});else for(currNode=this.last();i<newState.n.length;i++){var newNode=this.newNode("",{record:!1});currNode||(this.first(newNode),currNode=this.first()),newNode.state(newState.n[i]),currNode.next(newNode,{record:!1}),currNode=newNode}currNode=this.first();var edge=currNode.edgeToNext(),edges=newState.e;for(i=0;i<edges.length;i++)this.get(i).edgeToNext().state(edges[i])}else for(;this.first();)this.removeFirst({record:!1})},listproto.clear=function(){this.element.remove()},listproto.size=function(){for(var curNode=this.first(),size=0;curNode;)size++,curNode=curNode.next();return size},listproto.equals=function(otherList,options){return this.first()||otherList.first()?this.first()?this.first().equals(otherList.first(),options):!1:!0},listproto.css=JSAV.utils._helpers.css,listproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),JSAV.utils._events._addEventSupport(listproto);var ListNode=function(container,value,options){this.jsav=container.jsav,this.container=container,this._next=options.next,this._value=value,this.options=$.extend(!0,{visible:!0},options);var el=$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span><span class='jsavpointerarea'></span></div>"),valtype=typeof value;"object"===valtype&&(valtype="string"),this.element=el,el.addClass("jsavnode jsavlistnode").attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this),"first"in options&&options.first?this.container.element.prepend(el):this.container.element.append(el),this._next&&(this._edgetonext=new Edge(this.jsav,this,this._next,{"arrow-end":"classic-wide-long"}),this.options.edgeLabel&&this._edgetonext.label(this.options.edgeLabel)),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(ListNode,JSAV._types.ds.Node);var listnodeproto=ListNode.prototype;listnodeproto.next=function(newNext,options){return"undefined"==typeof newNext?this._next:(this._edgetonext&&this._edgetonext.show(),this._setnext(newNext,options))},listnodeproto._setnext=JSAV.anim(function(newNext,options){var oldNext=this._next;return this._next=newNext,newNext&&this._edgetonext?this._edgetonext.end(newNext):newNext&&(this._edgetonext=new Edge(this.jsav,this,this._next,{"arrow-end":"classic-wide-long"})),options&&options.edgeLabel&&this._edgetonext.label(options.edgeLabel),[oldNext]}),listnodeproto.edgeToNext=function(){return this._edgetonext},listnodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value())return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals)return!1}if(this.next()&&this.edgeToNext()){var edgeEquals=this.edgeToNext().equals(otherNode.edgeToNext(),$.extend({},options,{dontCheckNodes:!0}));if(!edgeEquals)return!1}return this.next()?this.next().equals(otherNode.next(),options):otherNode.next()?!1:!0};var dstypes=JSAV._types.ds;dstypes.List=List,dstypes.ListNode=ListNode;var horizontalNodePosUpdate=function(node,prevNode,prevPos,opts){var nodePos=node.element.position(),newPos={left:nodePos.left,top:nodePos.top},result={node:node,nodePos:newPos};opts.updateLeft&&(newPos.left=prevNode?prevPos.left+prevNode.element.outerWidth()+opts.nodegap:0),opts.updateTop&&(newPos.top=0);var edge=prevNode?prevNode._edgetonext:void 0;return edge&&opts.updateEdges&&(result.edge=edge,result.edgeFromPoint=[prevPos.left+prevNode.element.outerWidth()-5,prevPos.top+Math.round(prevNode.element.outerHeight()/2)]),result},verticalNodePosUpdate=function(node,prevNode,prevPos,opts){var nodePos=node.element.position(),newPos={left:nodePos.left,top:nodePos.top},result={node:node,nodePos:newPos};opts.updateLeft&&(newPos.left=0),opts.updateTop&&(newPos.top=prevNode?prevPos.top+prevNode.element.outerHeight()+opts.nodegap:0);var edge=prevNode?prevNode._edgetonext:void 0;return edge&&opts.updateEdges&&(result.edge=edge,result.edgeFromPoint=[prevPos.left+Math.round(prevNode.element.outerWidth()/2),prevPos.top+prevNode.element.outerHeight()-5]),result},listLayout=function(list,options,updateFunc){for(var prevNode,curPos,width,height,left,curPosData,curNode=list.first(),opts=$.extend({updateLeft:!0,updateTop:!0,updateEdges:!0},list.options,options),prevPos={},minLeft=Number.MAX_VALUE,minTop=Number.MAX_VALUE,maxLeft=Number.MIN_VALUE,maxTop=Number.MIN_VALUE,posData=[];curNode;)curPosData=updateFunc(curNode,prevNode,prevPos,opts),curPos=curPosData.nodePos,minLeft="undefined"!=typeof curPos.left?Math.min(curPos.left,minLeft):minLeft,minTop="undefined"!=typeof curPos.top?Math.min(curPos.top,minTop):minTop,maxLeft="undefined"!=typeof curPos.left?Math.max(curPos.left+curNode.element.outerWidth(),maxLeft):maxLeft,maxTop="undefined"!=typeof curPos.top?Math.max(curPos.top+curNode.element.outerHeight(),maxTop):maxTop,posData.unshift(curPosData),prevNode=curNode,prevPos=curPos,curNode=curNode.next();if(list.size())width=maxLeft-minLeft,height=maxTop-minTop;else{var tmpNode=list.newNode("");width=tmpNode.element.outerWidth(),height=tmpNode.element.outerHeight(),tmpNode.clear()}if(left=centerList(list,width,opts),!opts.boundsOnly){list.css({width:width,height:height}),left&&list.translateX(left);for(var i=posData.length-1;i>=0;i--){var posItem=posData[i];posItem.node.moveTo(posItem.nodePos.left,posItem.nodePos.top),posItem.edge&&posItem.edge.layout({fromPoint:posItem.edgeFromPoint,end:posItem.nodePos})}}return{width:width,height:height,left:left,top:list.element.position().top}},verticalList=function(list,options){return list.element.addClass("jsavverticallist"),listLayout(list,options,verticalNodePosUpdate)},horizontalList=function(list,options){return list.element.addClass("jsavhorizontallist"),listLayout(list,options,horizontalNodePosUpdate)};JSAV.ext.ds.layout.list={_default:horizontalList,horizontal:horizontalList,vertical:verticalList},JSAV.ext.ds.list=function(options){return new List(this,options)}}}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var Edge=JSAV._types.ds.Edge,Graph=function(jsav,options){this._nodes=[],this._edges=[],this._alledges=null,this.jsav=jsav,this.options=$.extend({visible:!0,nodegap:40,autoresize:!0,width:400,height:200,directed:!1,center:!0},options);var el=this.options.element||$("<div/>");el.addClass("jsavgraph");for(var key in this.options){var val=this.options[key];(this.options.hasOwnProperty(key)&&"string"==typeof val||"number"==typeof val||"boolean"==typeof val)&&el.attr("data-"+key,val)}this.options.element||$(jsav.canvas).append(el),this.element=el,el.attr({id:this.id()}).width(this.options.width).height(this.options.height),this.options.autoresize&&el.addClass("jsavautoresize"),this.options.center&&el.addClass("jsavcenter"),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options)};Graph._nodeSortFunction=function(a,b){return a.value()-b.value()},JSAV.utils.extend(Graph,JSAV._types.ds.JSAVDataStructure);var graphproto=Graph.prototype;graphproto.css=JSAV.utils._helpers.css,graphproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),graphproto._setnodes=JSAV.anim(function(newnodes,options){var oldnodes=this._nodes;
return this._nodes=newnodes,[oldnodes,options]}),graphproto._setadjs=JSAV.anim(function(newadjs,options){var oldadjs=this._edges;return this._edges=newadjs,this._alledges=null,[oldadjs,options]}),graphproto._setadjlist=JSAV.anim(function(newadj,index,options){var oldadj=this._edges[index];return this._edges[index]=newadj,this._alledges=null,[oldadj,index,options]}),graphproto.newNode=function(value,options){var newNode=new GraphNode(this,value,options),newNodes=this._nodes.slice(0);newNodes.push(newNode),this._setnodes(newNodes,options);var newAdjs=this._edges.slice(0);return newAdjs.push([]),this._setadjs(newAdjs,options),newNode},graphproto.addNode=function(value,options){return this.newNode(value,options)},graphproto.removeNode=function(node,options){var nodeIndex=this._nodes.indexOf(node);if(-1!==nodeIndex){for(var allEdges=this.edges(),i=allEdges.length;i--;){var edge=allEdges[i];(edge.start().id()===node.id()||edge.end().id()===node.id())&&this.removeEdge(edge,options)}var firstAdjs=this._edges.slice(0,nodeIndex),newAdjs=firstAdjs.concat(this._edges.slice(nodeIndex+1));this._setadjs(newAdjs,options);var firstNodes=this._nodes.slice(0,nodeIndex),newNodes=firstNodes.concat(this._nodes.slice(nodeIndex+1));return this._setnodes(newNodes,options),node.hide(options),this}},graphproto.addEdge=function(fromNode,toNode,options){if(!this.hasEdge(fromNode,toNode)){var opts=$.extend({},this.options,options);opts.directed&&!opts["arrow-end"]&&(opts["arrow-end"]="classic-wide-long");var fromIndex=this._nodes.indexOf(fromNode),toIndex=this._nodes.indexOf(toNode);if(-1!==fromIndex&&-1!==toIndex){var edge=new Edge(this.jsav,fromNode,toNode,opts),adjlist=this._edges[fromIndex].slice(0);return adjlist.push(edge),this._setadjlist(adjlist,fromIndex,opts),edge}}},graphproto.removeEdge=function(fNode,tNode,options){var edge,fromNode,toNode,opts;if(fNode.constructor===JSAV._types.ds.Edge?(edge=fNode,fromNode=edge.start(),toNode=edge.end(),opts=tNode):(fromNode=fNode,toNode=tNode,edge=this.getEdge(fromNode,toNode),opts=options),edge){var fromIndex=this._nodes.indexOf(fromNode),adjlist=(this._nodes.indexOf(toNode),this._edges[fromIndex]),edgeIndex=adjlist.indexOf(edge),newAdjlist=adjlist.slice(0,edgeIndex).concat(adjlist.slice(edgeIndex+1));this._setadjlist(newAdjlist,fromIndex,options),edge.hide()}},graphproto.hasEdge=function(fromNode,toNode){return this.getEdge(fromNode,toNode)},graphproto.getEdge=function(fromNode,toNode){for(var edges=this.edges(),i=0,l=edges.length;l>i;i++){var edge=edges[i];if(edge.start()===fromNode&&edge.end()===toNode)return edge;if(!this.options.directed&&edge.end()===fromNode&&edge.start()===toNode)return edge}return void 0},graphproto.nodes=function(){return JSAV.utils.iterable(this._nodes)},graphproto.nodeCount=function(){return this._nodes.length};var collectAllEdges=function(graph){for(var alledges=[],i=0,l=graph._edges.length;l>i;i++)for(var j=0,ll=graph._edges[i].length;ll>j;j++){var edge=graph._edges[i][j];-1===alledges.indexOf(edge)&&alledges.push(edge)}return alledges};graphproto.edges=function(){return this._alledges||(this._alledges=collectAllEdges(this)),JSAV.utils.iterable(this._alledges)},graphproto.edgeCount=function(){return this._alledges||(this._alledges=collectAllEdges(this)),this._alledges.length},graphproto.equals=function(other,options){if(!other instanceof Graph)return!1;if(this.nodeCount()!==other.nodeCount()||this.edgeCount()!==other.edgeCount())return!1;for(var myNodes=this.nodes().sort(Graph._nodeSortFunction),otherNodes=other.nodes().sort(Graph._nodeSortFunction),i=myNodes.length;i--;)if(!myNodes[i].equals(otherNodes[i],options))return!1;return!0},graphproto.clone=function(opts){var cloneOpts=$.extend(this.options,{visible:!1},opts);"element"in cloneOpts&&delete cloneOpts.element;var cloneNode,cloneNodes,n,e,i,fromInd,toInd,edgeOpts,cloneGraph=this.jsav.ds.graph(cloneOpts),nodes=this.nodes(Graph._nodeSortFunction),edges=this.edges();for(i=0;i<nodes.length;i++)n=nodes[i],cloneNode=cloneGraph.addNode(n.value(),cloneOpts),cloneNode.element.attr("style",n.element.attr("style")),cloneNode.element.attr("class",n.element.attr("class"));for(cloneNodes=cloneGraph.nodes(Graph._nodeSortFunction),i=0;i<edges.length;i++)e=edges[i],fromInd=nodes.indexOf(e.start()),toInd=nodes.indexOf(e.end()),edgeOpts="undefined"!=typeof e.weight()?{weight:e.weight()}:{},cloneGraph.addEdge(cloneNodes[fromInd],cloneNodes[toInd],$.extend({},cloneOpts,edgeOpts));return cloneGraph},graphproto.state=function(newState){if("undefined"==typeof newState){var i,e,state={},nodes=[],edges=[],nodelist=this.nodes(Graph._nodeSortFunction),edgelist=this.edges();for(i=0;i<nodelist.length;i++)nodes.push(nodelist[i].state());for(i=0;i<edgelist.length;i++)e=edgelist[i],edges.push([nodelist.indexOf(e.start()),nodelist.indexOf(e.end()),e.state()]);return state.n=nodes,state.e=edges,state}var i,l,e,newE,edges=this.edges(),nodes=this.nodes(Graph._nodeSortFunction),newNodes=newState.n,newEdges=newState.e;for(i=0,l=edges.length;l>i;i++)e=edges[i],this.removeEdge(e.start(),e.end(),{record:!1});for(i=0;i<nodes.length&&i<newNodes.length;i++)nodes[i].state(newNodes[i]);for(;i<nodes.length;)this.removeNode(nodes[nodes.length-1]),i++;for(;i<newNodes.length;){var newNode=this.newNode("",{record:!1});newNode.state(newNodes[nodes.length]),nodes.push(newNode),i++}for(i=0,l=newEdges.length;l>i;i++)e=newEdges[i],newE=this.addEdge(nodes[e[0]],nodes[e[1]],{record:!1}),newE.state(e[2])},JSAV.utils._events._addEventSupport(graphproto),graphproto.layout=function(options){var layoutAlg=this.options.layout||"_default";return this.jsav.ds.layout.graph[layoutAlg](this,options)};var SpringLayout=function(graph,options){this.graph=graph,this.iterations=2e3,this.maxRepulsiveForceDistance=6,this.k=2,this.c=.01,this.maxVertexMovement=.5,this.results={},this.nodes=graph.nodes(),this.edges=graph.edges(),this.layout();for(var node,edge,res,factorX=(graph.element.width()-this.maxNodeWidth)/(this.layoutMaxX-this.layoutMinX),factorY=(graph.element.height()-this.maxNodeHeight)/(this.layoutMaxY-this.layoutMinY),i=0,l=this.nodes.length;l>i;i++)node=this.nodes[i],res=this.results[node.id()],node.moveTo((res.layoutPosX-this.layoutMinX)*factorX,Math.max(0,(res.layoutPosY-this.layoutMinY)*factorY-node.element.outerHeight()));for(i=0,l=this.edges.length;l>i;i++)edge=this.edges[i],edge.layout(options)};/*!
   * Graph layout algorithm based on Graph Dracula
   * https://github.com/strathausen/dracula
   * Graph Dracula is "released under the MIT license"
   */
SpringLayout.prototype={layout:function(){this.layoutPrepare();for(var i=0;i<this.iterations;i++)this.layoutIteration();this.layoutCalcBounds()},layoutPrepare:function(){for(var i=0,l=this.nodes.length;l>i;i++){var node={};node.layoutPosX=0,node.layoutPosY=0,node.layoutForceX=0,node.layoutForceY=0,this.results[this.nodes[i].id()]=node}},layoutCalcBounds:function(){var i,x,y,l,n,minx=1/0,maxx=-1/0,miny=1/0,maxy=-1/0,nodes=this.nodes,maxNodeWidth=-1/0,maxNodeHeight=-1/0;for(i=0,l=nodes.length;l>i;i++)n=nodes[i],x=this.results[n.id()].layoutPosX,y=this.results[n.id()].layoutPosY,x>maxx&&(maxx=x),minx>x&&(minx=x),y>maxy&&(maxy=y),miny>y&&(miny=y),maxNodeWidth=Math.max(maxNodeWidth,n.element.outerWidth()),maxNodeHeight=Math.max(maxNodeHeight,n.element.outerHeight());this.layoutMinX=minx,this.layoutMaxX=maxx,this.layoutMinY=miny,this.layoutMaxY=maxy,this.maxNodeWidth=maxNodeWidth,this.maxNodeHeight=maxNodeHeight},layoutIteration:function(){var nodes,edges,i,l,j,k,prev=[];for(nodes=this.nodes,i=0,l=nodes.length;l>i;i++){var node1=nodes[i];for(j=0,k=prev.length;k>j;j++){var node2=nodes[prev[j]];this.layoutRepulsive(node1,node2)}prev.push(i)}for(edges=this.edges,i=0,l=edges.length;l>i;i++){var edge=edges[i];this.layoutAttractive(edge)}for(nodes=this.nodes,i=0,l=nodes.length;l>i;i++){var node=this.results[nodes[i].id()],xmove=this.c*node.layoutForceX,ymove=this.c*node.layoutForceY,max=this.maxVertexMovement;xmove>max&&(xmove=max),-max>xmove&&(xmove=-max),ymove>max&&(ymove=max),-max>ymove&&(ymove=-max),node.layoutPosX+=xmove,node.layoutPosY+=ymove,node.layoutForceX=0,node.layoutForceY=0}},layoutRepulsive:function(node1,node2){if("undefined"!=typeof node1&&"undefined"!=typeof node2){var lay1=this.results[node1.id()],lay2=this.results[node2.id()],dx=lay2.layoutPosX-lay1.layoutPosX,dy=lay2.layoutPosY-lay1.layoutPosY,d2=dx*dx+dy*dy;.01>d2&&(dx=.1*Math.random()+.1,dy=.1*Math.random()+.1,d2=dx*dx+dy*dy);var d=Math.sqrt(d2);if(d<this.maxRepulsiveForceDistance){var repulsiveForce=this.k*this.k/d;lay2.layoutForceX+=repulsiveForce*dx/d,lay2.layoutForceY+=repulsiveForce*dy/d,lay1.layoutForceX-=repulsiveForce*dx/d,lay1.layoutForceY-=repulsiveForce*dy/d}}},layoutAttractive:function(edge){var node1=edge.start(),node2=edge.end(),lay1=this.results[node1.id()],lay2=this.results[node2.id()],dx=lay2.layoutPosX-lay1.layoutPosX,dy=lay2.layoutPosY-lay1.layoutPosY,d2=dx*dx+dy*dy;.01>d2&&(dx=.1*Math.random()+.1,dy=.1*Math.random()+.1,d2=dx*dx+dy*dy);var d=Math.sqrt(d2);d>this.maxRepulsiveForceDistance&&(d=this.maxRepulsiveForceDistance,d2=d*d);var attractiveForce=(d2-this.k*this.k)/this.k;void 0===edge.attraction&&(edge.attraction=1),attractiveForce*=.5*Math.log(edge.attraction)+1,lay2.layoutForceX-=attractiveForce*dx/d,lay2.layoutForceY-=attractiveForce*dy/d,lay1.layoutForceX+=attractiveForce*dx/d,lay1.layoutForceY+=attractiveForce*dy/d}};/*! End Graph Dracula -based code
  */
var springLayout=function(graph){new SpringLayout(graph)},manualLayout=function(graph){var i,l,edge,edges=graph.edges();for(i=0,l=edges.length;l>i;i++)edge=edges[i],edge.layout()};JSAV.ext.ds.layout.graph={_default:manualLayout,automatic:springLayout,manual:manualLayout};var dagreLayout=function(graph,options){if(!("dagre"in window))return void console.error("You are trying to use the layered layout, please load dagre.js (https://github.com/cpettitt/dagre)!");for(var opts=$.extend({},graph.options,options),g=new dagre.Digraph,nodes=graph.nodes(),nmap={};nodes.hasNext();){var node=nodes.next();nmap[node.id()]=node,g.addNode(node.id(),{width:node.bounds().width,height:node.bounds().height})}for(var edges=graph.edges();edges.hasNext();){var edge=edges.next();g.addEdge(null,edge.start().id(),edge.end().id())}var layout=dagre.layout().run(g),maxX=-1,maxY=-1;layout.eachNode(function(u,value){opts.boundsOnly||nmap[u].moveTo(value.x-value.width/2,value.y-value.height/2),maxX=Math.max(value.x+value.width,maxX),maxY=Math.max(value.y+value.height,maxY)});var graphDims={width:maxX+5,height:maxY+5};if(!opts.boundsOnly)for(graph.css(graphDims),edges=graph.edges();edges.hasNext();)edge=edges.next(),edge.layout();return $.extend({top:graph.position().top},graphDims)};JSAV.ext.ds.layout.graph.layered=dagreLayout;var GraphNode=function(container,value,options){this.jsav=container.jsav,this.container=container,this.options=$.extend(!0,{visible:!0,left:0,top:0},options);var el=this.options.nodeelement||$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span></div>"),valtype=typeof value;"object"===valtype&&(valtype="string"),this.element=el,el.addClass("jsavnode jsavgraphnode").attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this),this.options.autoResize&&el.addClass("jsavautoresize"),this.container.element.append(el),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(GraphNode,JSAV._types.ds.Node);var nodeproto=GraphNode.prototype;nodeproto.css=JSAV.utils._helpers.css,nodeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),nodeproto.neighbors=function(){var edges,edge,i,l,neighbors=[];if(this.container.options.directed)for(edges=this.container._edges[this.container._nodes.indexOf(this)],i=0,l=edges.length;l>i;i++)neighbors.push(edges[i].end());else for(edges=this.container.edges(),i=0,l=edges.length;l>i;i++)edge=edges[i],edge.start()===this?neighbors.push(edge.end()):edge.end()===this&&neighbors.push(edge.start());return JSAV.utils.iterable(neighbors)},nodeproto.edgeTo=function(node){return this.container.getEdge(this,node)},nodeproto.edgeFrom=function(node){return node.edgeTo(this)},nodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value())return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals)return!1}var myNeighbor,otherNeighbor,myNeighbors=this.neighbors().sort(Graph._nodeSortFunction),otherNeighbors=otherNode.neighbors().sort(Graph._nodeSortFunction);if(myNeighbors.length!==otherNeighbors.length)return!1;var i;for(i=myNeighbors.length;i--;){if(myNeighbor=myNeighbors[i],otherNeighbor=otherNeighbors[i],myNeighbor.value()!==otherNeighbor.value())return!1;if(!this.container.getEdge(this,myNeighbor).equals(otherNode.container.getEdge(otherNode,otherNeighbor),$.extend({},options,{dontCheckNodes:!0})))return!1}return!0};var dstypes=JSAV._types.ds;dstypes.Graph=Graph,dstypes.GraphNode=GraphNode,JSAV.ext.ds.graph=function(options){return new Graph(this,$.extend(!0,{visible:!0,autoresize:!0},options))}}}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var defaultOptions=(JSAV.utils._helpers.getIndices,{style:"table",autoresize:!0,center:!0,visible:!0}),Matrix=function(jsav,initialData,options){this.jsav=jsav;var i;if($.isArray(initialData))this.options=$.extend({},defaultOptions,options),options=this.options;else if("object"==typeof initialData){this.options=$.extend({},defaultOptions,initialData),options=this.options;var temparr=[];for(initialData=[],temparr.length=options.columns,i=options.rows;i--;)initialData.push(temparr)}else console.error("Invalid arguments for initializing a matrix!");this.element=options.element?$(options.element):$("<div class='jsavmatrix' />").appendTo(jsav.canvas),"id"in options&&this.id(options.id,{record:!1}),this.element.addClass("jsavmatrix"+options.style);var arrayElem,arrayOpts=$.extend({},options,{center:!1,visible:!1});for(delete arrayOpts.id,delete arrayOpts.left,delete arrayOpts.top,delete arrayOpts.relativeTo,this._arrays=[],i=0;i<initialData.length;i++)arrayElem=$("<ol />"),arrayOpts.element=arrayElem,this.element.append(arrayElem),this._arrays[i]=jsav.ds.array(initialData[i],arrayOpts),arrayElem.css("display","block");this.options=$.extend(!0,{},options),JSAV.utils._helpers.handlePosition(this),this.layout(),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Matrix,JSAV._types.ds.JSAVDataStructure);var matrixproto=Matrix.prototype;matrixproto.swap=function(row1,col1,row2,col2,options){return this.jsav.effects.swapValues(this._arrays[row1],col1,this._arrays[row2],col2,options),this},matrixproto.state=function(newState){var i,l,_arrays=this._arrays;if(newState){for(i=0,l=_arrays.length;l>i;i++)_arrays[i].state(newState[i]);return this}var state=[];for(i=0,l=_arrays.length;l>i;i++)state.push(_arrays[i].state());return state},matrixproto.layout=function(options){var dimensions,i,l=this._arrays.length,maxWidth=-1;for(this.options.center&&this.element.addClass("jsavcenter"),i=0;l>i;i++)dimensions=this._arrays[i].layout(options),maxWidth=Math.max(maxWidth,dimensions.width);this.element.width(maxWidth+"px")},matrixproto.equals=function(other,options){var i,_arrays,_other;if($.isArray(other)){for(i=other.length;i--;)if(!this._arrays[i].equals(other[i],options))return!1}else{if(other.constructor!==Matrix)return console.error("Unknown type of object for comparing with matrix:",other),!1;if(_arrays=this._arrays,_other=other._arrays,_other.length!==_arrays.length)return!1;for(i=_other.length;i--;)if(!_arrays[i].equals(_other[i],options))return!1}return!0};for(var arrayFunctions=["highlight","unhighlight","isHighlight","css","value","addClass","hasClass","removeClass","toggleClass"],arrayFunctionWrapper=function(funcname){return function(){var arrIndex=arguments[0];if("number"==typeof arrIndex){var array=this._arrays[arrIndex];return array[funcname].apply(array,[].slice.call(arguments,1))}}},i=arrayFunctions.length;i--;)matrixproto[arrayFunctions[i]]=arrayFunctionWrapper(arrayFunctions[i]);var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"],eventhandler=function(eventType){return function(data,handler){var self=this;return this.element.on(eventType,".jsavindex",function(e){var targetArray=$(this).parent(),row=self.element.find(".jsavarray").index(targetArray),col=targetArray.find(".jsavindex").index(this);if(self.jsav.logEvent({type:"jsav-matrix-"+eventType,matrixid:self.id(),row:row,column:col}),$.isFunction(data))data.call(self,row,col,e);else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.unshift(col),params.unshift(row),params.push(e),handler.apply(self,params)}}),this}};for(i=events.length;i--;)matrixproto[events[i]]=eventhandler(events[i]);matrixproto.on=function(eventName,data,handler){return eventhandler(eventName).call(this,data,handler),this},JSAV._types.ds.Matrix=Matrix,JSAV.ext.ds.matrix=function(initialData,options){return new Matrix(this,initialData,options)}}}(jQuery),function($){"use strict";function getCodeLineElements(self,linenum){"string"==typeof linenum&&(linenum=self.options.tags&&"undefined"!=typeof self.options.tags[linenum]?self.options.tags[linenum]:void 0);var indices;if(linenum)if("number"==typeof linenum)indices=linenum-1;else if($.isArray(linenum)){indices=[];for(var i=0;i<linenum.length;i++)indices[i]=linenum[i]-1}else $.isFunction(linenum)&&(indices=function(ind){return linenum(ind+1)});return getIndices($(self.element).find("li.jsavcodeline"),indices)}if("undefined"!=typeof JSAV){var getIndices=JSAV.utils._helpers.getIndices,Variable=function(jsav,value,options){this.jsav=jsav,this.options=$.extend({visible:!1,type:typeof value},options),this.element=$('<div class="jsavvariable"><span class="jsavvarlabel"></span> <span class="jsavvalue"><span class="jsavvaluelabel jsavvarvalue">'+value+"</span></span></div>"),this.element.find(".jsavvarvalue").attr("data-value",value),this.element.data("var",this),this.options.before?this.element.insertBefore(this.options.before.element):this.options.after?this.element.insertAfter(this.options.after.element):$(this.jsav.canvas).append(this.element),this.options.label&&this.element.find(".jsavvarlabel").html(this.options.label),this.options.name&&this.element.attr("data-varname",this.options.name),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Variable,JSAV._types.JSAVObject);var varproto=Variable.prototype;varproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible),varproto.show=JSAV.ext.effects.show,varproto.hide=JSAV.ext.effects.hide,JSAV.utils._events._addEventSupport(varproto,{selector:".jsavvalue",logEventPrefix:"jsav-var-",dataField:"var"}),varproto._setValue=JSAV.anim(function(newValue,options){var oldValue=this.value();return this.element.find(".jsavvarvalue").html(newValue),this.element.find(".jsavvarvalue").attr("data-value",newValue),[oldValue,options]}),varproto.value=function(newValue,options){if("undefined"==typeof newValue){var val=this.element.find(".jsavvarvalue").attr("data-value");return JSAV.utils.value2type(val,this.options.type)}return this._setValue(newValue,options),this},varproto.state=function(newstate){if(!newstate){var state={t:this.options.type,v:this.value()},cls=JSAV.utils._helpers.elementClasses(this.element),style=this.element.attr("style");return style&&(state.style=style),cls.length>0&&(state.cls=cls),state}this.options.type=newstate.t,this.value(newstate.v,{record:!1}),JSAV.utils._helpers.setElementClasses(this.element,newstate.cls||[]),this.element.attr("style",newstate.style||"")},varproto.equals=function(otherVariable,options){if(!otherVariable||"object"!=typeof otherVariable||this.value()!==otherVariable.value())return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherVariable,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherVariable,options["class"]);if(!classEquals)return!1}return!0},varproto.css=JSAV.utils._helpers.css,varproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss),varproto.addClass=JSAV.utils._helpers.addClass,varproto.removeClass=JSAV.utils._helpers.removeClass,varproto.hasClass=JSAV.utils._helpers.hasClass,varproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass),varproto.highlight=function(options){this.addClass("jsavhighlight",options)},varproto.unhighlight=function(options){this.removeClass("jsavhighlight",options)},varproto.isHighlight=function(){return this.hasClass("jsavhighlight")},JSAV._types.Variable=Variable,JSAV.ext.variable=function(value,options){return new Variable(this,value,options)};var Pointer=function(jsav,name,options){this.jsav=jsav;var defaultOptions={visible:!0,follow:!0,anchor:"left top",myAnchor:"left bottom",left:0,top:"-20px"};if(this.options=$.extend(defaultOptions,options),this.element=$('<div class="jsavpointer"><div class="jsavlabel">'+name+'</div><div class="jsavpointerarea"></div></div>'),this.options.before?this.element.insertBefore(this.options.before.element):this.options.after?this.element.insertAfter(this.options.after.element):this.options.container?this.options.container.append(this.element):$(this.jsav.canvas).append(this.element),"undefined"!=typeof this.options.targetIndex?(this.options.relativeTo=this.options.relativeTo.index(this.options.targetIndex),delete this.options.targetIndex,delete this.options.relativeIndex):"undefined"!=typeof this.options.relativeIndex&&(this.options.relativeTo=this.options.relativeTo.index(this.options.relativeIndex),delete this.options.relativeIndex),!this.options.fixed){this.options.follow=!0;var pointer=this,arrowPointerListener=function(dleft,dtop){pointer._pointerLeftSum+=dleft,pointer._pointerTopSum+=dtop};this._arrowPointerCallback=arrowPointerListener}JSAV.utils._helpers.setRelativePositioning(this,$.extend({},this.options,{callback:this._arrowPointerCallback})),JSAV.utils._helpers.handleVisibility(this,this.options),this._target=this.options.relativeTo,this._target&&this._createArrow()};JSAV.utils.extend(Pointer,JSAV._types.Label);var pointerproto=Pointer.prototype;pointerproto._setArrowTargetFollower=function(){this._targetLeftSum=0,this._targetTopSum=0;var pointer=this;if(!this._arrowUpdateRelativeListener){var arrowUpdateRelativeListener=function(){pointer.isVisible()&&(pointer._translateArrowPoints(pointer._pointerLeftSum,pointer._pointerTopSum,pointer._targetLeftSum,pointer._targetTopSum),pointer._targetLeftSum=0,pointer._targetTopSum=0,pointer._pointerLeftSum=0,pointer._pointerTopSum=0)};this._arrowUpdateRelativeListener=arrowUpdateRelativeListener,pointer.jsav.container.on("jsav-updaterelative",arrowUpdateRelativeListener)}var arrowTargetListener=function(dleft,dtop){pointer._targetLeftSum+=dleft,pointer._targetTopSum+=dtop};JSAV.utils._helpers._setRelativeFollowUpdater(this.arrow,this._target,{callback:arrowTargetListener,autotranslate:!1})},pointerproto._translateArrowPoints=function(startDiffX,startDiffY,endDiffX,endDiffY){var curPoints=this.arrow.points();curPoints[0][0]+=startDiffX,curPoints[0][1]+=startDiffY,curPoints[1][0]+=endDiffX,curPoints[1][1]+=endDiffY,this.arrow.movePoints([[0,curPoints[0][0],curPoints[0][1]],[1,curPoints[1][0],curPoints[1][1]]])},pointerproto._createArrow=function(){var arrowPoints=this._arrowPoints(),arrow=this.jsav.g.line(arrowPoints[0][1],arrowPoints[0][2],arrowPoints[1][1],arrowPoints[1][2],{"arrow-end":"classic-wide","arrow-start":"oval-medium-medium","stroke-width":2,opacity:0});this.isVisible()&&arrow.show(),this._pointerLeftSum=0,this._pointerTopSum=0,this.arrow=arrow,this._setArrowTargetFollower()},pointerproto._setTarget=JSAV.anim(function(newTarget){var oldTarget=this.target();return this._target=newTarget,[oldTarget]}),pointerproto._arrowPoints=function(newLeft,newTop,options){"object"==typeof newLeft&&(options=newLeft,newLeft=null,newTop=null);var opts=$.extend({},this.options,options),myBounds=this.bounds(),targetPoint=this._calculateArrowTargetPosition(this._target,opts),newPoints=[[0,(newLeft||myBounds.left)+myBounds.width/2+1,(newTop||myBounds.top)+myBounds.height-5],[1,targetPoint[0],targetPoint[1]]];return newPoints},pointerproto._calculateArrowTargetPosition=function(target,opts){var myBounds=this.bounds();if(null===this._target)return[myBounds.left+myBounds.width/2+5,myBounds.top+myBounds.height+5];var horzPercentMapping={left:0,center:50,right:100},vertPercentMapping={top:0,center:50,bottom:100},arrowHorzAnchor=50,arrowVertAnchor=0,arrowAnchor=opts.arrowAnchor||this.options.arrowAnchor;if(arrowAnchor){var anchor=arrowAnchor.split(" ");1===anchor.length?arrowHorzAnchor=arrowVertAnchor=parseInt(anchor[0],10):(arrowHorzAnchor=horzPercentMapping[anchor[0]],"number"!=typeof arrowHorzAnchor&&(arrowHorzAnchor=parseInt(anchor[0],10)),arrowVertAnchor=vertPercentMapping[anchor[1]],"number"!=typeof arrowVertAnchor&&(arrowVertAnchor=parseInt(anchor[1],10)))}var targetElem=target.element,targetOffset=targetElem.offset(),canvasOffset=this.jsav.canvas.offset(),targetBounds={width:targetElem.outerWidth(),height:targetElem.outerHeight(),left:targetOffset.left-canvasOffset.left,top:targetOffset.top-canvasOffset.top};return[targetBounds.left+targetBounds.width*arrowHorzAnchor/100,targetBounds.top+targetBounds.height*arrowVertAnchor/100]},pointerproto.target=function(newTarget,options){if("undefined"==typeof newTarget)return this._target;var opts=$.extend({},options);if("undefined"!=typeof opts.targetIndex?(newTarget=newTarget.index(opts.targetIndex),delete opts.targetIndex,delete opts.relativeIndex):"undefined"!=typeof opts.relativeIndex&&(newTarget=newTarget.index(opts.relativeIndex),delete opts.relativeIndex),this._setTarget(newTarget,opts),null===newTarget)return this.arrow&&this.arrow.hide(),this.addClass("jsavnullpointer"),this;if(this.removeClass("jsavnullpointer"),this.arrow?this.arrow.isVisible()||this.arrow.show():this._createArrow(opts),this._pointerLeftSum=0,this._pointerTopSum=0,!this.options.fixed){JSAV.utils._helpers.setRelativePositioning(this,$.extend({},this.options,opts,{relativeTo:newTarget,callback:this._arrowPointerCallback}))}this._setArrowTargetFollower();var newTargetArrowPoint=this._calculateArrowTargetPosition(newTarget,opts),currTargetPoint=this.arrow.points()[1];return this._targetLeftSum+=newTargetArrowPoint[0]-currTargetPoint[0],this._targetTopSum+=newTargetArrowPoint[1]-currTargetPoint[1],this},pointerproto._orighide=pointerproto.hide,pointerproto.hide=function(options){this._orighide(options),this.arrow&&this.arrow.hide()},pointerproto._origshow=pointerproto.show,pointerproto.show=function(options){this._origshow(options),this.arrow&&this.arrow.show()},pointerproto.equals=function(otherPointer,options){if(!otherPointer||!otherPointer instanceof Pointer)return!1;if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherPointer,options.css);if(!cssEquals)return!1}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherPointer,options["class"]);if(!classEquals)return!1}return this.target().equals(otherPointer.target(),options)},JSAV.ext.pointer=function(name,target,options){return new Pointer(this,name,$.extend({},options,{relativeTo:target}))},JSAV._types.Pointer=Pointer;var trimRightRegexp=/\s+$/,trimLeftRegexp=/^\s*\n/,Code=function(jsav,codelines,options){this.jsav=jsav,"undefined"==typeof codelines?codelines=[]:"string"==typeof codelines?codelines=codelines.split("\n"):"object"!=typeof codelines||$.isArray(codelines)||(options=codelines,$.ajax({url:options.url,async:!1,mimeType:"text/plain",success:function(data){var tmp,code=data;options.startAfter&&(tmp=code.split(options.startAfter),code=tmp[tmp.length-1]),options.endBefore&&(code=code.split(options.endBefore)[0]),code=code.replace(trimRightRegexp,"").replace(trimLeftRegexp,""),codelines=code.split("\n")}})),this.options=$.extend({visible:!0,lineNumbers:!0,htmlEscape:!0,center:!0},options);var elem=this.options.lineNumbers?"ol":"ul";this.element=this.options.element||$("<"+elem+' class="jsavcode"></'+elem+">"),this.options.before?this.element.insertBefore(this.options.before.element):this.options.after?this.element.insertAfter(this.options.after.element):$(this.jsav.canvas).append(this.element);for(var clElems=$(),i=0,l=codelines.length;l>i;i++)clElems=clElems.add(createCodeLine(codelines[i],this));if(this.element.append(clElems),JSAV.utils._helpers.handlePosition(this),JSAV.utils._helpers.handleVisibility(this,this.options),this.options.center&&!this.options.left&&!this.options.right&&!this.options.top&&!this.options.bottom){var prevDisplay=this.element.css("display");this.element.css("display","inline-block"),this.element.css("width",this.element.outerWidth()),this.element.css("display",prevDisplay),this.element.addClass("jsavcenter")}},createCodeLine=function(code,container){var clElem=$('<li class="jsavcodeline">');return container.options.htmlEscape?clElem.text(code):clElem.html(code),clElem};JSAV.utils.extend(Code,JSAV._types.JSAVObject);var codeproto=Code.prototype;codeproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible),codeproto.addCodeLine=JSAV.anim(function(newLine){this.element.append(createCodeLine(newLine,this))}),codeproto.highlight=function(linenum){return this.addClass(linenum,"jsavhighlight")},codeproto.unhighlight=function(linenum){return this.removeClass(linenum,"jsavhighlight")},codeproto.isHighlight=function(linenum){return this.hasClass(linenum,"jsavhighlight")},codeproto.toggleClass=JSAV.anim(function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);return this.jsav._shouldAnimate()?this.jsav.effects._toggleClass($elems,className,options):$elems.toggleClass(className),[linenum,className]}),codeproto.addClass=function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);return $elems.hasClass(className)?this:this.toggleClass(linenum,className,options)},codeproto.removeClass=function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);return $elems.hasClass(className)?this.toggleClass(linenum,className,options):this},codeproto.hasClass=function(linenum,className){var $elems=getCodeLineElements(this,linenum);return $elems.hasClass(className)},codeproto._setcss=JSAV.anim(function(indices,cssprops,options){var $elems=getCodeLineElements(this,indices);return this.jsav._shouldAnimate()?this.jsav.effects.transition($elems,cssprops,options):$elems.css(cssprops),this}),codeproto.setCurrentLine=function(linenum,options){var $curr=this.element.find("li.jsavcurrentline"),currlinenum=this.element.find("li.jsavcodeline").index($curr)+1,$prev=this.element.find("li.jsavpreviousline"),prevlinenum=this.element.find("li.jsavcodeline").index($prev)+1;return"string"==typeof linenum&&(linenum=this.options.tags&&"undefined"!=typeof this.options.tags[linenum]?this.options.tags[linenum]:0),0===linenum?(0!==currlinenum&&this.toggleClass(currlinenum,"jsavcurrentline"),0!==prevlinenum&&this.toggleClass(prevlinenum,"jsavpreviousline")):0===prevlinenum&&0===currlinenum?this.toggleClass(linenum,"jsavcurrentline"):0===prevlinenum&&0!==currlinenum&&linenum!==currlinenum?(this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options),this.toggleClass(linenum,"jsavcurrentline")):0!==prevlinenum&&0!==currlinenum&&linenum!==currlinenum&&linenum!==prevlinenum&&prevlinenum!==currlinenum?(this.toggleClass(prevlinenum,"jsavpreviousline",options),this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options),this.toggleClass(linenum,"jsavcurrentline",options)):prevlinenum===linenum&&currlinenum===linenum||(0!==prevlinenum&&0!==currlinenum&&linenum===prevlinenum?(this.toggleClass(prevlinenum,"jsavpreviousline jsavcurrentline",options),this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options)):0!==prevlinenum&&0!==currlinenum&&linenum===currlinenum?(this.toggleClass(prevlinenum,"jsavpreviousline",options),this.toggleClass(currlinenum,"jsavpreviousline",options)):0!==prevlinenum&&0!==currlinenum&&currlinenum===prevlinenum&&(this.toggleClass(prevlinenum,"jsavcurrentline",options),this.toggleClass(linenum,"jsavcurrentline",options))),this},codeproto.css=function(linenum,cssprop,options){var $elems=getCodeLineElements(this,linenum);if("string"==typeof cssprop)return $elems.css(cssprop);if("string"==typeof linenum&&"undefined"==typeof cssprop)return this.element.css(linenum);if($.isFunction(linenum)){for(var all_elems=$(this.element).find("li.jsavcodeline"),sel_indices=[],i=0;i<$elems.size();i++)sel_indices.push(all_elems.index($elems[i])+1);linenum=sel_indices}return this._setcss(linenum,cssprop,options)},codeproto.show=function(linenum,options){return"undefined"!=typeof linenum&&"object"!=typeof linenum||$.isArray(linenum)||0!==this.element.filter(":visible").size()?this.removeClass(linenum,"jsavhiddencode",options):this._toggleVisible(linenum)},codeproto.hide=function(linenum,options){return"undefined"!=typeof linenum&&"object"!=typeof linenum||$.isArray(linenum)||1!==this.element.filter(":visible").size()?this.addClass(linenum,"jsavhiddencode",options):this._toggleVisible(linenum)},codeproto.state=function(newState){return"undefined"==typeof newState?{html:this.element.html()}:void this.element.html(newState.html)},JSAV._types.Code=Code,JSAV.ext.code=function(codelines,options){return new Code(this,codelines,options)}}}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var speedChoices=[5e3,3e3,1500,1e3,500,400,300,200,100,50],getSpeedChoice=function(speedVal){for(var curval=speedChoices.length-1;curval&&speedChoices[curval]<speedVal;)curval--;return curval+1},speedSetting=function(settings){return function(){var translate;if(settings.jsav)translate=settings.jsav._translate;else{var lang="en";window.JSAV_OPTIONS&&window.JSAV_OPTIONS.lang&&"object"==typeof JSAV._translations[window.JSAV_OPTIONS.lang]&&(lang=window.JSAV_OPTIONS.lang),translate=JSAV.utils.getInterpreter(JSAV._translations,lang)}var curSpeed=JSAV.ext.SPEED,rangeSupported=!!$.support.inputTypeRange,curval=getSpeedChoice(curSpeed),$elem=$('<div class="jsavrow">'+translate("animationSpeed")+(rangeSupported?" "+translate("(slowFast)"):"")+': <input type="range" min="1" max="10" step="1" size="30" value="'+curval+'"/> '+(rangeSupported?"":"<button>"+translate("save")+'</button><div class="jsavhelp">'+translate("valueBetween1And10"))+"</div>"),speedChangeHandler=function(){var speed=parseInt($(this).val(),10);isNaN(speed)||1>speed||speed>10||(speed=speedChoices[speed-1],curSpeed=speed,JSAV.ext.SPEED=speed,$(document).trigger("jsav-speed-change",speed),localStorage&&localStorage.setItem("jsav-speed",speed))},$inputElem=$elem.find("input").val(curval);return rangeSupported?$inputElem.change(speedChangeHandler):$elem.find("button").click(function(){speedChangeHandler.call($inputElem);var savedElem=$("<span>"+translate("saved")+"</span>");setTimeout(function(){savedElem.fadeOut()},1e3),$(this).after(savedElem)}),$elem}},createInputComponent=function(varname,options){var label,opts=$.extend({type:"text"},options),input=$('<input id="jsavsettings-'+varname+'" type="'+opts.type+'"/>');"label"in opts&&(label=$('<label for="jsavsettings-'+varname+'">'+opts.label+"</label>")),"value"in opts&&input.val(opts.value);for(var attr in opts)-1===["label","value","type"].indexOf(attr)&&input.attr(attr,opts[attr]);return $('<div class="jsavrow"/>').append(label).append(input)},createSelectComponent=function(varname,options){var label,select=$('<select id="jsavsettings-'+varname+'" />');"label"in options&&(label=$('<label for="jsavsettings-'+varname+'">'+options.label+"</label>"));var opts=options.options;for(var key in opts)opts.hasOwnProperty(key)&&select.append('<option value="'+key+'">'+opts[key]+"</option>");"value"in options&&select.val(options.value);var toCheck=["label","value","options","type"];for(var attr in options)-1===$.inArray(attr,toCheck)&&select.attr(attr,options[attr]);return $('<div class="jsavrow"/>').append(label).append(select)},Settings=function(elem){this.components=[],this.add(speedSetting(this));var that=this;elem&&$(elem).click(function(e){e.preventDefault(),that.show()})},sproto=Settings.prototype;sproto.show=function(){for(var $cont=$("<div class='jsavsettings'></div>"),i=0;i<this.components.length;i++)$cont.append(this.components[i]);$cont.append("<span class='jsavversion'>"+JSAV.version()+"</span>");var translate;if(this.jsav)translate=this.jsav._translate;else{var lang="en";window.JSAV_OPTIONS&&window.JSAV_OPTIONS.lang&&"object"==typeof JSAV._translations[window.JSAV_OPTIONS.lang]&&(lang=window.JSAV_OPTIONS.lang),translate=JSAV.utils.getInterpreter(JSAV._translations,lang)}var title=translate("settings");this.dialog=JSAV.utils.dialog($cont,{title:title})},sproto.close=function(){this.dialog&&this.dialog.close()},sproto.add=function(create,options){if(!$.isFunction(create)){if(!("type"in options))return;var elem,func;return func="select"===options.type?createSelectComponent:createInputComponent,elem=func(create,options),this.components.push(elem),elem.find("input, select")}this.components.push(create)},JSAV.utils.Settings=Settings,JSAV.init(function(){this.settings=this.options.settings?this.options.settings:new Settings($(this.container).find(".jsavsettings").show()),this.settings.jsav=this})}}(jQuery),function($){"use strict";var BLOCKED_ATTRIBUTES=["correct","comment","points"],createUUID=JSAV.utils.createUUID,questionSetting=function(jsav){return function(){var idPrefix="jsav"+jsav.id()+"ShowQuestions",$elem=$('<div class="jsavrow">Show Questions: <input id="'+idPrefix+'Yes" type="radio" value="true" name="jsav-questions" /><label for="'+idPrefix+'Yes">Yes</label><input  id="'+idPrefix+'No" type="radio" value="false" name="jsav-questions" /><label for="'+idPrefix+'No">No</label></div>');return jsav.options.showQuestions?$elem.find("#"+idPrefix+"Yes").prop("checked",!0):$elem.find("#"+idPrefix+"No").prop("checked",!0),$elem.find("input").on("change",function(){jsav.options.showQuestions="true"===$(this).val()}),$elem}},createInputComponent=function(label,itemtype,options){var labelElem=$('<label for="'+options.id+'">'+label+"</label>"),input=$('<input id="'+options.id+'" type="'+itemtype+'"/>');return $.each(options,function(key,value){-1===BLOCKED_ATTRIBUTES.indexOf(key)&&input.attr(key,value)}),$('<div class="jsavrow"/>').append(input).append(labelElem)},feedbackFunction=function($elems){var cbs=$elems.find('[type="checkbox"]'),that=this,correct=!0;0===cbs.size()&&(cbs=$elems.find('[type="radio"]'));var answer,answers=[];return cbs.each(function(index,item){var qi=that.choiceById(item.id),$item=$(item);answer={label:qi.label,selected:!!$item.prop("checked"),type:$item.attr("type"),correct:!0},!!$item.prop("checked")!=!!qi.options.correct&&(correct=!1,answer.correct=!1),answers.push(answer)}),$elems.filter(".jsavfeedback").html(this.jsav._translate(correct?"questionCorrect":"questionIncorrect")).removeClass("jsavcorrect jsavincorrect").addClass(correct?"jsavcorrect":"jsavincorrect"),$elems.filter('[type="submit"]').remove(),{correct:correct,answers:answers}},qTypes={};qTypes.TF={init:function(){this.name=createUUID(),this.choices[0]=new QuestionItem(this.options.falseLabel||"False","radio",{name:this.name,correct:!this.options.correct}),this.choices[1]=new QuestionItem(this.options.trueLabel||"True","radio",{name:this.name,correct:!!this.options.correct}),this.correctChoice=function(correctVal){correctVal?this.choices[1].correct=!0:this.choices[0].correct=!0}},feedback:feedbackFunction},qTypes.MC={init:function(){this.name=createUUID()},addChoice:function(label,options){return this.choices.push(new QuestionItem(label,"radio",$.extend({name:this.name},options))),this},feedback:feedbackFunction},qTypes.MS={addChoice:function(label,options){return this.choices.push(new QuestionItem(label,"checkbox",$.extend({},options))),this},feedback:feedbackFunction};var QuestionItem=function(label,itemtype,options){this.label=label,this.itemtype=itemtype,this.options=$.extend({},options),"id"in this.options||(this.options.id=createUUID()),this.correct=this.options.correct||!1};QuestionItem.prototype.elem=function(){return createInputComponent(this.label,this.itemtype,this.options)};var Question=function(jsav,qtype,questionText,options){this.jsav=jsav,this.asked=!1,this.choices=[],this.questionText=questionText,this.maxPoints=1,this.achievedPoints=-1,this.qtype=qtype.toUpperCase(),this.options=options;var funcs=qTypes[this.qtype],that=this;$.each(funcs,function(fName,f){that[fName]=f}),this.init()},qproto=Question.prototype;qproto.id=function(newId){return"undefined"==typeof newId?this.id:void(this.id=newId)},qproto.show=JSAV.anim(function(){if(!this.asked&&this.jsav._shouldAnimate()&&this.jsav.options.showQuestions){this.jsav.disableControls(),this.asked=!0;var i,$elems=$(),that=this;$elems=$elems.add($('<div class="jsavfeedback" > </div>'));var order=[];for(i=this.choices.length;i--;)order.push(i);for(i=5*order.length;i--;){var rand1=JSAV.utils.rand.numKey(0,order.length+1),rand2=JSAV.utils.rand.numKey(0,order.length+1),tmp=order[rand1];order[rand1]=order[rand2],order[rand1]=tmp}for(i=0;i<this.choices.length;i++)$elems=$elems.add(this.choices[order[i]].elem());
var close=$('<input type="button" value="'+this.jsav._translate("questionClose")+'" />').click(function(){that.dialog.close()});close.css("display","none"),$elems=$elems.add(close);var submit=$('<input type="submit" value="'+this.jsav._translate("questionCheck")+'" />').click(function(){var logData=that.feedback($elems);logData.question=that.questionText,logData.type="jsav-question-answer",that.options.id&&(logData.questionId=that.options.id),that.jsav.logEvent(logData),that.jsav.options.questionResubmissionAllowed||(submit.remove(),close.show())});$elems=$elems.add(submit);var closeCallback=function(){var logData={type:"jsav-question-close",question:that.questionText};that.jsav.enableControls(),that.options.id&&(logData.questionId=that.options.id),that.jsav.logEvent(logData)},dialogClass=this.jsav.options.questionDialogClass||"";this.dialog=JSAV.utils.dialog($elems,{title:this.questionText,dialogRootElement:this.jsav.options.questionDialogBase,closeCallback:closeCallback,closeOnClick:!1,dialogClass:dialogClass}),this.dialog.filter(".jsavdialog").addClass("jsavquestiondialog");var logChoices=[];for(i=0;i<this.choices.length;i++){var c=this.choices[i];logChoices.push({label:c.label,correct:c.correct})}var logData={type:"jsav-question-show",question:this.questionText,questionType:this.qtype,choices:logChoices};return this.options.id&&(logData.questionId=this.options.id),this.jsav.logEvent(logData),$elems}}),qproto.choiceById=function(qiId){for(var i=this.choices.length;i--;)if(this.choices[i].options.id===qiId)return this.choices[i];return null},qproto.state=function(){};var noop=function(){};$.each(["init","feedback","addChoice"],function(index,val){qproto[val]=noop});var QuestionFrame=function(jsav,url,options){this.jsav=jsav,this.url=url,this.options=options,this._showed=!1},qfproto=QuestionFrame.prototype;qfproto._createElement=function(){var $iframe=$("<iframe src='"+this.url+"'></iframe>");return $iframe.prop("seamless",!0),this.options.attr&&$iframe.attr(this.options.attr),$iframe.addClass("jsavquestionframe"),$iframe},qfproto.show=JSAV.anim(function(){if(!this._showed&&this.jsav._shouldAnimate()&&this.jsav.options.showQuestions){this._showed=!0;var $iframe=this.options.element||this._createElement(),opts=$.extend({closeOnClick:!1},this.options);delete opts.attr;var that=this;opts.closeCallback=function(){var logData={type:"jsav-question-closeiframe",question:that.questionText};that.options.id&&(logData.questionId=that.options.id),that.jsav.logEvent(logData)},JSAV.utils.dialog($iframe,opts);var logData={type:"jsav-question-showiframe",url:this.url};opts.id&&(logData.questionId=opts.id),this.jsav.logEvent(logData)}}),qfproto.state=function(){},JSAV.ext.question=function(qtype,questionText,options){!this._questionSetting&&this.settings&&(this._questionSetting=!0,this.settings.add(questionSetting(this)));var logData={type:"jsav-question-created",question:questionText};return this.logEvent(logData),"IFRAME"===qtype?new QuestionFrame(this,questionText,options):new Question(this,qtype,questionText,$.extend({},options))},JSAV.ext.resetQuestionAnswers=function(){this.begin();for(var i=0;i<this._redo.length;i++)for(var stepOperations=this._redo[i].operations,j=0;j<stepOperations.length;j++){var obj=stepOperations[j].obj;obj&&obj instanceof Question&&(obj.asked=!1)}},JSAV.init(function(){"undefined"==typeof this.options.showQuestions&&(this.options.showQuestions=!0),this.container.bind({"jsav-question-reset":function(){this.resetQuestionAnswers()}.bind(this)})})}(jQuery),function($){"use strict";if("undefined"!=typeof JSAV){var gradeStepFilterFunction=function(step){return step.options.grade},Exercise=function(jsav,options){this.jsav=jsav,this.options=jQuery.extend({reset:function(){},controls:null,feedback:"atend",feedbackSelectable:!1,fixmode:"undo",fixmodeSelectable:!1,grader:"default",resetButtonTitle:this.jsav._translate("resetButtonTitle"),undoButtonTitle:this.jsav._translate("undoButtonTitle"),modelButtonTitle:this.jsav._translate("modelButtonTitle"),gradeButtonTitle:this.jsav._translate("gradeButtonTitle")},window.JSAV_EXERCISE_OPTIONS,options);var cont=$(this.options.controls),self=this;0===cont.size()&&(cont=this.jsav.container.find(".jsavexercisecontrols"));var resetHandler=function(){self.jsav.logEvent({type:"jsav-exercise-reset"}),self.reset()},modelHandler=function(){cont.addClass("active"),self.jsav.logEvent({type:"jsav-exercise-model-open"}),self.showModelanswer(),cont.removeClass("active")};if(this.jsav.container.bind({"jsav-exercise-reset":resetHandler,"jsav-exercise-model":modelHandler}),cont.size()){var $reset=$('<input type="button" name="reset" value="'+this.options.resetButtonTitle+'" />').click(resetHandler),$model=$('<input type="button" name="answer" value="'+this.options.modelButtonTitle+'" />').click(modelHandler),$action=$('<span class="actionIndicator"></span>');if("continuous"!==this.options.feedback){var $grade=$('<input type="button" name="grade" value="'+this.options.gradeButtonTitle+'" />').click(function(){cont.addClass("active"),self.showGrade(),cont.removeClass("active"),self.jsav.logEvent({type:"jsav-exercise-grade",score:$.extend({},self.score)})}),$undo=$('<input type="button" name="undo" value="'+this.options.undoButtonTitle+'" />"').click(function(){self.jsav.logEvent({type:"jsav-exercise-undo"}),self.undo()});cont.append($undo,$reset,$model,$grade,$action)}else cont.append($reset,$model,$action);$action.position({of:cont.children().last(),at:"right center",my:"left center",offset:"5 -2"})}this.options.feedbackSelectable&&(this.feedback=this.jsav.settings.add("feedback",{type:"select",options:{continuous:this.jsav._translate("continuous"),atend:this.jsav._translate("atend")},label:this.jsav._translate("feedbackLabel"),value:this.options.feedback})),this.options.fixmodeSelectable&&(this.fixmode=this.jsav.settings.add("fixmode",{type:"select",options:{undo:this.jsav._translate("undo"),fix:this.jsav._translate("fix")},label:this.jsav._translate("fixLabel"),value:this.options.fixmode}));var $jsavscore=this.jsav.container.find(".jsavscore");1===$jsavscore.size()&&0===$jsavscore.children().size()&&"continuous"===this.options.feedback&&($jsavscore.html(this.jsav._translate("scoreLabel")+' <span class="jsavcurrentscore"></span> / <span class="jsavmaxscore" ></span>, <span class="jsavamidone">'+this.jsav._translate("remainingLabel")+' <span class="jsavpointsleft"></span></span>, '+this.jsav._translate("lostLabel")+' <span class="jsavpointslost" ></span>'),this._defaultscoretext=!0),this.options.showGrade&&$.isFunction(this.options.showGrade)&&(this.showGrade=this.options.showGrade);var exer=this;jsav.gradeableStep=function(){exer.gradeableStep.apply(exer,arguments)}};Exercise.GradeStepFilterFunction=gradeStepFilterFunction;var allEqual=function(initial,model,compare){if($.isArray(initial)){compare||(compare=[]);for(var i=0;i<initial.length;i++)if(!model[i].equals(initial[i],compare[i]))return!1;return!0}return model.equals(initial,compare)},graders={"default":function(){var studentSteps=0,correct=!0,forwStudent=!0,forwModel=!0,modelAv=this.modelav,studentAv=this.jsav,modelTotal=modelAv.totalSteps(),studentTotal=studentAv.totalSteps();for(this.score.correct=0,this.score.student=0;correct&&forwStudent&&forwModel&&modelAv.currentStep()<=modelTotal&&studentAv.currentStep()<=studentTotal;)forwStudent=studentAv.forward(gradeStepFilterFunction),forwModel=modelAv.forward(gradeStepFilterFunction),forwStudent&&studentSteps++,correct=!1,forwModel&&forwModel&&forwStudent&&allEqual(this.initialStructures,this.modelStructures,this.options.compare)&&(correct=!0,this.score.correct++);for(forwStudent=!0;forwStudent&&studentAv.currentStep()<studentTotal;)forwStudent=studentAv.forward(gradeStepFilterFunction),forwStudent&&studentSteps++;this.score.student=studentSteps},"default-continuous":function(){var forwModel,modelAv=this.modelav,studentAv=this.jsav;modelAv.currentStep()<modelAv.totalSteps()&&studentAv.currentStep()<=studentAv.totalSteps()&&(forwModel=modelAv.forward(gradeStepFilterFunction),this.score.student++,forwModel&&allEqual(this.initialStructures,this.modelStructures,this.options.compare)&&this.score.correct++),studentAv.forward()},finalStep:function(){this.score.correct=0,this.score.student=1,this.score.total=1,this.modelav.end(),this.jsav.end(),allEqual(this.initialStructures,this.modelStructures,this.options.compare)&&(this.score.correct=1)},finder:function(){var cont=!0,forwStudent=!0,forwModel=!0,modelAv=this.modelav,studentAv=this.jsav,modelTotal=modelAv.totalSteps(),studentTotal=studentAv.totalSteps();for(this.score.correct=0,this.score.student=0;forwModel&&cont&&modelAv.currentStep()<=modelTotal&&studentAv.currentStep()<=studentTotal;)if(forwModel=modelAv.forward(gradeStepFilterFunction)){for(forwStudent=!0;forwStudent&&!allEqual(this.initialStructures,this.modelStructures,this.options.compare)&&studentAv.currentStep()<=studentTotal;)forwStudent=studentAv.forward();allEqual(this.initialStructures,this.modelStructures,this.options.compare)?this.score.correct++:cont=!1}}};graders["finalStep-continuous"]=graders.finalStep;var exerproto=Exercise.prototype;exerproto._updateScore=function(){if("continuous"===this.options.feedback){this.modelav||(this.modelanswer(),this.grade());var container=this.jsav.container,score=this.score;this._defaultscoretext&&container.find(".jsavamidone").html(score.total===score.correct?this.jsav._translate("doneLabel"):this.jsav._translate("remainingLabel")+" <span class='jsavpointsleft'></span>");var undo=score.undo;this._undoneSteps[this.jsav.currentStep()]&&(undo-=1),container.find(".jsavcurrentscore").text(score.correct-undo),container.find(".jsavcurrentmaxscore").text(score.correct+score.fix+score.undo),container.find(".jsavmaxscore").text(score.total),container.find(".jsavpointsleft").text(score.total-score.correct-score.fix||this.jsav._translate("doneLabel")),container.find(".jsavpointslost").text(score.fix||score.undo||0)}},exerproto.grade=function(continuousMode){this.modelav||this.modelanswer();var origStep=this.jsav.currentStep(),origModelStep=this.modelav.currentStep();continuousMode||(this.jsav.begin(),this.modelav.begin());var prevFx=$.fx.off||!1;return $.fx.off=!0,$.isFunction(this.options.grader)?this.options.grader.call(this):graders[this.options.grader+(continuousMode?"-continuous":"")].call(this),continuousMode||(this.jsav.jumpToStep(origStep),this.modelav.jumpToStep(origModelStep)),$.fx.off=prevFx,this.score},exerproto.showGrade=function(){this.grade();var grade=this.score,msg=this.jsav._translate("yourScore")+" "+grade.correct+" / "+grade.total;grade.fix>0&&(msg+="\n"+this.jsav._translate("fixedSteps")+" "+grade.fix),window.alert(msg)},exerproto.modelanswer=function(returnToStep){this.modelDialog&&this.modelDialog.remove();var modelav,model=this.options.model,self=this,modelOpts=$.extend({title:this.jsav._translate("modelWindowTitle"),closeOnClick:!1,modal:!1,closeCallback:function(){self.jsav.logEvent({type:"jsav-exercise-model-close"}),"number"==typeof returnToStep&&modelav.jumpToStep(returnToStep)}},this.options.modelDialog);modelOpts.dialogClass?modelOpts.dialogClass+=" jsavmodelpreparing":modelOpts.dialogClass="jsavmodelpreparing";var modelLogHandler=function(eventData){eventData.av=self.jsav.id(),eventData.type=eventData.type.replace("jsav-","jsav-exercise-model-"),$("body").trigger("jsav-log-event",eventData)};if($.isFunction(model)){modelav=new JSAV($("<div><span class='jsavcounter'/><div class='jsavcontrols'/><p class='jsavoutput jsavline'></p></div>").addClass("jsavmodelanswer"),{logEvent:modelLogHandler}),modelav.gradeableStep=function(){this.stepOption("grade",!0),this.step()},this.modelDialog=JSAV.utils.dialog(modelav.container,modelOpts),this.modelStructures=model(modelav),modelav.recorded();var oldFx=$.fx.off||!1;$.fx.off=!0;for(var forwModel=!0,modelTotal=modelav.totalSteps(),totalSteps=0;forwModel&&modelav.currentStep()<=modelTotal;)forwModel=modelav.forward(gradeStepFilterFunction),forwModel&&totalSteps++;$.fx.off=oldFx,modelav.begin(),this.modelDialog.hide(),this.score.total=totalSteps,this.modelav=modelav}},exerproto.showModelanswer=function(){var prevPosition=this.modelav?this.modelav.currentStep():0;this.modelanswer(prevPosition),this.modelav.begin(),this.modelDialog.removeClass("jsavmodelpreparing"),this.modelDialog.show()},exerproto.reset=function(){this.jsav.clearAnimation(),this.score={total:0,correct:0,undo:0,fix:0,student:0},this._undoneSteps=[],this.jsav.RECORD=!0,this.initialStructures=this.options.reset(),this.jsav.displayInit(),this.jsav.recorded(),this.modelav&&(this.modelav.container.remove(),this.modelav=void 0,this.modelStructures=void 0),this.jsav._undo=[],this._updateScore(),this.jsav.logEvent({type:"jsav-exercise-init",exercise:this})},exerproto.undo=function(){var oldFx=$.fx.off||!1;$.fx.off=!0,this.jsav.backward(),this.jsav.backward();var undoGraders=["default","finder","finalStep"];-1!==undoGraders.indexOf(this.options.grader)&&this.jsav.backward(gradeStepFilterFunction)?(this.jsav.forward(),this.jsav.step({updateRelative:!1})):this.jsav.begin(),this.jsav._redo=[],$.fx.off=oldFx};var moveModelBackward=function(exer){exer.modelav.backward(),exer.modelav.backward(gradeStepFilterFunction)&&exer.modelav.forward()};exerproto.gradeableStep=function(){var prevFx=$.fx.off||!1;if($.fx.off=!0,this._fixing)return void(this.options.debug&&console.error("exercise.gradeableStep() shouldn't be called in fix function"));this.jsav.stepOption("grade",!0),this.jsav.step();var that=this;if(this.feedback&&"continuous"===this.feedback.val()||!this.feedback&&"continuous"===this.options.feedback){var doContinuousGrading=function(){var grade=that.grade(!0);if(grade.student===grade.correct)return that.jsav.logEvent({type:"jsav-exercise-grade-change",score:$.extend({},grade)}),void that._updateScore();if(grade.correct!==grade.total){var fixmode=that.fixmode?that.fixmode.val():that.options.fixmode;if("none"!==fixmode&&(that.undo(),that.score.student--),"fix"===fixmode&&$.isFunction(that.options.fix)){that._fixing=!0;{that.modelav,that.jsav}that.fix(that.modelStructures),delete that._fixing,that.score.fix++,that.jsav.stepOption("grade",!0),that.jsav.step(),that.options.debug&&!allEqual(that.initialStructures,that.modelStructures,that.options.compare)&&console.error("The fix function did not work as expected, the structures aren't equal"),that.jsav.logEvent({type:"jsav-exercise-step-fixed",score:$.extend({},grade)}),window.alert(that.jsav._translate("fixedPopup"))}else"fix"===fixmode?(that._undoneSteps[that.jsav.currentStep()]||(that.score.undo++,that._undoneSteps[that.jsav.currentStep()]=!0),that.jsav.logEvent({type:"jsav-exercise-step-undone",score:$.extend({},grade)}),moveModelBackward(that),window.alert(that.jsav._translate("fixFailedPopup"))):"none"===fixmode||(that._undoneSteps[that.jsav.currentStep()]||(that.score.undo++,that._undoneSteps[that.jsav.currentStep()]=!0),that.jsav.logEvent({type:"jsav-exercise-step-undone",score:$.extend({},grade)}),moveModelBackward(that),window.alert(that.jsav._translate("undonePopup")));that._updateScore()}};that.jsav._clearPlaying(function(){that.jsav.logEvent({type:"jsav-exercise-gradeable-step"}),doContinuousGrading(),$.fx.off=prevFx})}else this.jsav._clearPlaying(function(){that.jsav.logEvent({type:"jsav-exercise-gradeable-step"})}),$.fx.off=prevFx},exerproto.fix=function(){var fix=this.options.fix;if($.isFunction(fix)){var prevFx=$.fx.off||!1;$.fx.off=!0,fix(this.modelStructures),$.fx.off=prevFx}},exerproto._jsondump=function(){var jsav=this.jsav,states=[],forw=!0,initial=this.initialStructures,origStep=jsav.currentStep(),oldFx=$.fx.off||!1;$.fx.off=!0;var getstate=function(){if($.isArray(initial)){for(var state=[],i=0,l=initial.length;l>i;i++)state.push(initial[i].state());return state}return initial.state()};for(jsav.begin();forw;)states.push(getstate()),forw=jsav.forward();return this.jsav.jumpToStep(origStep),$.fx.off=oldFx,JSON.stringify(states)},JSAV._types.Exercise=Exercise,JSAV.ext.exercise=function(model,reset,options){var opts=$.extend({model:model,reset:reset},options);return new Exercise(this,opts)}}}(jQuery),function(){if("undefined"!=typeof JSAV){var theVERSION="v1.0.1-6-gea2e525";JSAV.version=function(){return theVERSION}}}();